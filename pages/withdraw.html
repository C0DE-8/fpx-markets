<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Withdraw - fpx-markets</title>
    <!-- Axios CDN -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #0f1419;
            color: #ffffff;
            min-height: 100vh;
            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
            overflow-y: auto;
        }

        .header {
            background: #0f1419;
            padding: 20px 40px;
            border-bottom: 1px solid #2a3441;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            color: #8b5cf6;
            font-size: 24px;
            font-weight: bold;
        }

        .nav-links {
            margin-left: auto;
            display: flex;
            gap: 20px;
        }

        .nav-link {
            color: #9ca3af;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .nav-link:hover {
            color: #ffffff;
            background: rgba(139, 92, 246, 0.1);
        }

        .nav-link.active {
            color: #8b5cf6;
            background: rgba(139, 92, 246, 0.1);
        }

        /* Mobile Menu Button */
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: #9ca3af;
            font-size: 24px;
            cursor: pointer;
            margin-left: auto;
        }

        /* Mobile Navigation */
        .mobile-nav {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 20, 25, 0.95);
            z-index: 1000;
            padding: 20px;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transform: translateY(-100%);
            transition: transform 0.3s ease;
        }

        .mobile-nav.active {
            transform: translateY(0);
        }

        .mobile-nav-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: #9ca3af;
            font-size: 24px;
            cursor: pointer;
        }

        .mobile-nav-links {
            display: flex;
            flex-direction: column;
            gap: 20px;
            align-items: center;
        }

        .mobile-nav-link {
            color: #9ca3af;
            text-decoration: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 18px;
            transition: all 0.2s ease;
            width: 200px;
            text-align: center;
        }

        .mobile-nav-link:hover {
            color: #ffffff;
            background: rgba(139, 92, 246, 0.1);
        }

        .mobile-nav-link.active {
            color: #8b5cf6;
            background: rgba(139, 92, 246, 0.1);
        }

        .main-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 40px;
            min-height: calc(100vh - 80px);
        }

        .page-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .page-title {
            font-size: 32px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 8px;
        }

        .page-subtitle {
            color: #9ca3af;
            font-size: 16px;
        }

        /* Withdrawal Form */
        .withdraw-container {
            background: #1a202c;
            border-radius: 16px;
            padding: 32px;
            border: 1px solid #2a3441;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .form-section {
            margin-bottom: 32px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-icon {
            font-size: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            color: #9ca3af;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .form-input {
            width: 100%;
            background: #374151;
            border: 1px solid #4b5563;
            border-radius: 8px;
            padding: 12px 16px;
            color: #ffffff;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #8b5cf6;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }

        .form-input:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .form-select {
            width: 100%;
            background: #374151;
            border: 1px solid #4b5563;
            border-radius: 8px;
            padding: 12px 16px;
            color: #ffffff;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .form-select:focus {
            outline: none;
            border-color: #8b5cf6;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }

        .form-select option {
            background: #374151;
            color: #ffffff;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .balance-info {
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin-top: 8px;
        }

        .balance-text {
            color: #8b5cf6;
            font-size: 14px;
            font-weight: 500;
        }

        .conversion-info {
            background: rgba(14, 165, 233, 0.1);
            border: 1px solid rgba(14, 165, 233, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin-top: 8px;
        }

        .conversion-text {
            color: #0ea5e9;
            font-size: 14px;
            font-weight: 500;
        }

        .otp-section {
            display: flex;
            gap: 12px;
            align-items: end;
        }

        .otp-input-group {
            flex: 1;
        }

        .send-otp-btn {
            background: #374151;
            border: 1px solid #4b5563;
            color: #9ca3af;
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
            font-weight: 500;
            white-space: nowrap;
            min-width: 120px;
        }

        .send-otp-btn:hover:not(:disabled) {
            background: #4b5563;
            color: #ffffff;
        }

        .send-otp-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .otp-timer {
            color: #f59e0b;
            font-size: 12px;
            margin-top: 4px;
        }

        .security-notice {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 24px;
        }

        .security-notice-title {
            color: #f59e0b;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .security-notice-text {
            color: #f59e0b;
            font-size: 13px;
            line-height: 1.5;
        }

        .withdraw-btn {
            width: 100%;
            background: #8b5cf6;
            color: #ffffff;
            border: none;
            padding: 16px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .withdraw-btn:hover:not(:disabled) {
            background: #7c3aed;
            transform: translateY(-1px);
        }

        .withdraw-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #ffffff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Loading State */
        .loading-state {
            text-align: center;
            padding: 60px 20px;
            color: #9ca3af;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(156, 163, 175, 0.3);
            border-radius: 50%;
            border-top-color: #9ca3af;
            animation: spin 1s ease-in-out infinite;
            margin: 0 auto 20px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6b7280;
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-title {
            color: #9ca3af;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .empty-subtitle {
            color: #6b7280;
            margin-bottom: 20px;
        }

        .empty-action {
            background: #8b5cf6;
            color: #ffffff;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-block;
        }

        .empty-action:hover {
            background: #7c3aed;
        }

        /* Toast Notification Styles */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-width: 400px;
        }

        .toast {
            padding: 16px 20px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 12px;
            transform: translateX(100%);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }

        .toast.hide {
            transform: translateX(100%);
            opacity: 0;
        }

        .toast-success {
            background: rgba(16, 185, 129, 0.15);
            border-color: rgba(16, 185, 129, 0.3);
            color: #10b981;
        }

        .toast-error {
            background: rgba(239, 68, 68, 0.15);
            border-color: rgba(239, 68, 68, 0.3);
            color: #ef4444;
        }

        .toast-warning {
            background: rgba(245, 158, 11, 0.15);
            border-color: rgba(245, 158, 11, 0.3);
            color: #f59e0b;
        }

        .toast-info {
            background: rgba(139, 92, 246, 0.15);
            border-color: rgba(139, 92, 246, 0.3);
            color: #8b5cf6;
        }

        .toast-icon {
            font-size: 20px;
            flex-shrink: 0;
        }

        .toast-content {
            flex: 1;
            font-weight: 500;
        }

        .toast-close {
            background: none;
            border: none;
            color: currentColor;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            opacity: 0.7;
            transition: opacity 0.2s ease;
            font-size: 18px;
            line-height: 1;
            flex-shrink: 0;
        }

        .toast-close:hover {
            opacity: 1;
        }

        .toast-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            background: currentColor;
            opacity: 0.3;
            transition: width linear;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
    .header {
        padding: 15px 20px;
        position: sticky;
        top: 0;
        z-index: 100;
    }

    .nav-links {
        display: none;
    }

    .mobile-menu-btn {
        display: block;
    }

    .mobile-nav {
        display: flex;
    }

    .main-container {
        padding: 15px;
        min-height: calc(100vh - 70px);
        overflow-y: auto;
        -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
    }

    .page-header {
        margin-bottom: 20px;
        text-align: center;
    }

    .page-title {
        font-size: 24px;
        margin-bottom: 6px;
    }

    .page-subtitle {
        font-size: 14px;
    }

    .withdraw-container {
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 30px;
    }

    .form-section {
        margin-bottom: 24px;
    }

    .section-title {
        font-size: 16px;
        margin-bottom: 12px;
    }

    .section-icon {
        font-size: 18px;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-label {
        font-size: 14px;
        margin-bottom: 8px;
    }

    .form-input, .form-select {
        padding: 14px 16px;
        font-size: 16px; /* Prevents zoom on iOS */
        border-radius: 10px;
        height: 50px; /* Consistent height for better touch */
    }

    .form-row {
        grid-template-columns: 1fr;
        gap: 20px;
    }

    .otp-section {
        flex-direction: column;
        align-items: stretch;
        gap: 12px;
    }

    .send-otp-btn {
        min-width: auto;
        padding: 14px 16px;
        font-size: 14px;
        border-radius: 10px;
        height: 50px;
    }

    .security-notice {
        padding: 16px;
        border-radius: 10px;
        margin-bottom: 24px;
    }

    .security-notice-title {
        font-size: 14px;
        margin-bottom: 8px;
    }

    .security-notice-text {
        font-size: 13px;
        line-height: 1.5;
    }

    .withdraw-btn {
        padding: 16px;
        font-size: 16px;
        border-radius: 12px;
        margin-top: 10px;
        height: 56px;
    }

    .balance-info, .conversion-info {
        padding: 14px;
        border-radius: 8px;
        margin-top: 10px;
    }

    .balance-text, .conversion-text {
        font-size: 14px;
    }

    .otp-timer {
        font-size: 12px;
        margin-top: 8px;
        text-align: center;
    }

    /* Improve toast container positioning */
    .toast-container {
        top: 70px; /* Below the sticky header */
        right: 10px;
        left: 10px;
        max-width: none;
    }

    .toast {
        padding: 12px 16px;
        border-radius: 10px;
        font-size: 14px;
        margin-bottom: 8px;
    }

    .toast-icon {
        font-size: 18px;
    }

    .loading-state, .empty-state {
        padding: 40px 20px;
    }

    .loading-spinner {
        width: 32px;
        height: 32px;
        margin: 0 auto 16px;
    }

    .empty-icon {
        font-size: 40px;
        margin-bottom: 12px;
    }

    .empty-title {
        font-size: 16px;
        margin-bottom: 6px;
    }

    .empty-subtitle {
        font-size: 14px;
        margin-bottom: 16px;
    }

    .empty-action {
        padding: 14px 24px;
        font-size: 14px;
        border-radius: 10px;
        height: 50px;
    }

    .debug-info {
        padding: 10px;
        font-size: 11px;
        border-radius: 8px;
        margin-top: 12px;
    }
    
    /* Add space at the bottom for better scrolling */
    #withdrawForm {
        padding-bottom: 30px;
    }
}

/* Small Mobile Devices */
@media (max-width: 480px) {
    .main-container {
        padding: 12px 10px;
    }

    .page-header {
        margin-bottom: 16px;
    }

    .page-title {
        font-size: 22px;
    }

    .page-subtitle {
        font-size: 13px;
    }

    .withdraw-container {
        padding: 16px;
        border-radius: 10px;
    }

    .form-section {
        margin-bottom: 20px;
    }

    .section-title {
        font-size: 15px;
        margin-bottom: 10px;
    }

    .form-group {
        margin-bottom: 18px;
    }

    .form-input, .form-select {
        padding: 12px 14px;
        font-size: 16px;
        border-radius: 8px;
    }

    .send-otp-btn {
        padding: 12px 14px;
        font-size: 13px;
    }

    .security-notice {
        padding: 14px;
        margin-bottom: 18px;
    }

    .security-notice-title {
        font-size: 13px;
        margin-bottom: 6px;
    }

    .security-notice-text {
        font-size: 12px;
        line-height: 1.4;
    }

    .withdraw-btn {
        padding: 14px;
        font-size: 15px;
        border-radius: 10px;
    }

    .balance-info, .conversion-info {
        padding: 12px;
        margin-top: 8px;
    }

    .balance-text, .conversion-text {
        font-size: 13px;
    }

    .toast {
        padding: 10px 14px;
        font-size: 13px;
    }

    .toast-icon {
        font-size: 16px;
    }
    
    /* Add more bottom space for better scrolling */
    #withdrawForm {
        padding-bottom: 40px;
    }
}

/* Very Small Mobile Devices */
@media (max-width: 360px) {
    .main-container {
        padding: 8px;
    }

    .withdraw-container {
        padding: 12px;
    }

    .page-title {
        font-size: 20px;
    }

    .section-title {
        font-size: 14px;
    }

    .form-input, .form-select {
        padding: 10px 12px;
        font-size: 16px;
    }

    .send-otp-btn {
        padding: 10px 12px;
        font-size: 12px;
    }

    .withdraw-btn {
        padding: 12px;
        font-size: 14px;
    }

    .security-notice {
        padding: 10px;
    }

    .balance-info, .conversion-info {
        padding: 8px;
    }
}

/* Landscape Mobile */
@media (max-height: 600px) and (orientation: landscape) {
    .main-container {
        padding: 10px;
        min-height: calc(100vh - 60px);
    }

    .page-header {
        margin-bottom: 20px;
    }

    .page-title {
        font-size: 20px;
        margin-bottom: 4px;
    }

    .page-subtitle {
        font-size: 12px;
    }

    .withdraw-container {
        padding: 16px;
    }

    .form-section {
        margin-bottom: 16px;
    }

    .section-title {
        font-size: 14px;
        margin-bottom: 8px;
    }

    .form-group {
        margin-bottom: 12px;
    }

    .form-input, .form-select {
        padding: 10px 12px;
    }

    .security-notice {
        padding: 10px;
        margin-bottom: 12px;
    }

    .withdraw-btn {
        padding: 12px;
        font-size: 14px;
    }
}

/* Touch-friendly improvements */
@media (hover: none) and (pointer: coarse) {
    /* Increase touch targets */
    .form-input, .form-select, .send-otp-btn, .withdraw-btn {
        min-height: 50px;
    }
    
    .security-option {
        min-height: 60px;
    }
    
    /* Add active state for touch feedback */
    .form-input:active, .form-select:active {
        border-color: #8b5cf6;
    }
    
    .send-otp-btn:active, .withdraw-btn:active {
        opacity: 0.8;
    }
    
    /* Improve scrolling */
    .modal-scrollable-content {
        padding-bottom: 30px;
    }
    
    /* Better spacing for touch */
    .security-options {
        gap: 16px;
    }
    
    /* Prevent double-tap zoom */
    .security-option, .security-btn, .send-otp-btn, .withdraw-btn {
        touch-action: manipulation;
    }
}

/* High DPI displays */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
    .form-input, .form-select {
        border-width: 0.5px;
    }
}

        .hidden {
            display: none;
        }

        /* Scam Detection Modal */
        .scam-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            padding: 20px;
            overflow-y: auto;
        }

        .scam-modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* Advanced Security Modal Styles */
        .scam-modal-container {
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
            border-radius: 20px;
            padding: 0;
            width: 100%;
            max-width: 700px;
            max-height: calc(100vh - 40px);
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.7);
            border: 1px solid #4a5568;
            transform: translateY(20px);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            margin: auto;
        }

        .scam-modal-overlay.active .scam-modal-container {
            transform: translateY(0);
        }

        /* Scrollable Content Area */
        .modal-content-wrapper {
            display: flex;
            flex-direction: column;
            height: 100%;
            max-height: calc(100vh - 40px);
        }

        .modal-scrollable-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 0;
        }

        /* Custom Scrollbar */
        .modal-scrollable-content::-webkit-scrollbar {
            width: 8px;
        }

        .modal-scrollable-content::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        .modal-scrollable-content::-webkit-scrollbar-thumb {
            background: rgba(139, 92, 246, 0.5);
            border-radius: 4px;
        }

        .modal-scrollable-content::-webkit-scrollbar-thumb:hover {
            background: rgba(139, 92, 246, 0.7);
        }

        /* Header with Company Branding */
        .security-modal-header {
            background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
            padding: 20px 24px;
            border-bottom: 2px solid #8b5cf6;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .security-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
            min-width: 0;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #8b5cf6, #06b6d4);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
            flex-shrink: 0;
        }

        .logo-text {
            min-width: 0;
            flex: 1;
        }

        .company-name {
            color: #ffffff;
            font-size: 16px;
            font-weight: 700;
            letter-spacing: -0.5px;
            line-height: 1.2;
        }

        .security-dept {
            color: #8b5cf6;
            font-size: 11px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            line-height: 1.2;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-shrink: 0;
        }

        .security-badge {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid #22c55e;
            border-radius: 16px;
            padding: 6px 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .badge-text {
            color: #22c55e;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        .badge-icon {
            color: #22c55e;
            font-weight: bold;
            font-size: 12px;
        }

        .modal-close-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #9ca3af;
            cursor: pointer;
            padding: 8px;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            flex-shrink: 0;
        }

        .modal-close-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            color: #ffffff;
            border-color: rgba(255, 255, 255, 0.3);
        }

        .security-notice-banner {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.15), rgba(245, 158, 11, 0.05));
            border: 1px solid rgba(245, 158, 11, 0.3);
            margin: 20px 24px;
            padding: 16px;
            border-radius: 12px;
            display: flex;
            gap: 12px;
            align-items: flex-start;
        }

        .notice-icon {
            font-size: 20px;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .notice-content {
            flex: 1;
            min-width: 0;
        }

        .notice-title {
            color: #f59e0b;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 6px;
            line-height: 1.3;
        }

        .notice-subtitle {
            color: #d1d5db;
            font-size: 13px;
            line-height: 1.4;
        }

        .security-question-container {
            padding: 0 24px 20px;
            flex: 1;
        }

        /* Footer - Always Visible */
        .security-modal-footer {
            background: rgba(0, 0, 0, 0.2);
            padding: 20px 24px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            flex-shrink: 0;
            position: sticky;
            bottom: 0;
            z-index: 10;
        }

        .security-progress-container {
            margin-bottom: 16px;
        }

        .progress-bar-container {
            background: rgba(255, 255, 255, 0.1);
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .progress-text {
            color: #9ca3af;
            font-size: 12px;
            font-weight: 500;
            text-align: center;
        }

        .security-actions {
            display: flex;
            justify-content: space-between;
            gap: 12px;
        }

        .security-btn {
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            display: flex;
            align-items: center;
            gap: 6px;
            min-width: 100px;
            justify-content: center;
            flex: 1;
        }

        /* Question and Options Styles */
        .security-question-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            opacity: 1;
            transform: translateY(0);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            flex-wrap: wrap;
            gap: 8px;
        }

        .question-number {
            background: linear-gradient(135deg, #8b5cf6, #06b6d4);
            color: #ffffff;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        .risk-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            color: #ef4444;
            font-size: 11px;
            font-weight: 500;
        }

        .question-text {
            color: #ffffff;
            font-size: 16px;
            font-weight: 500;
            line-height: 1.4;
            margin-bottom: 20px;
        }

        .security-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .security-option {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            color: #e5e7eb;
            font-size: 13px;
            line-height: 1.4;
            position: relative;
            overflow: hidden;
            user-select: none;
            word-wrap: break-word;
            hyphens: auto;
        }

        /* Results Container */
        .security-results {
            padding: 24px;
            text-align: center;
        }

        .result-icon-container {
            width: 60px;
            height: 60px;
            margin: 0 auto 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
        }

        .result-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 10px;
            letter-spacing: -0.5px;
            line-height: 1.3;
        }

        .result-subtitle {
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 24px;
            color: #d1d5db;
        }

        .risk-assessment-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            text-align: left;
        }

        .final-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 24px;
            flex-wrap: wrap;
        }

        .final-btn {
            padding: 14px 24px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            min-width: 140px;
            flex: 1;
            max-width: 200px;
        }

        .compliance-footer {
            background: rgba(0, 0, 0, 0.3);
            padding: 12px 24px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            flex-shrink: 0;
        }

        .compliance-text {
            color: #6b7280;
            font-size: 10px;
            text-align: center;
            line-height: 1.4;
        }

/* Mobile Responsive for Security Modal */
@media (max-width: 768px) {
    .scam-modal-overlay {
        padding: 0;
        align-items: flex-start;
    }
    
    .scam-modal-container {
        width: 100%;
        height: 100%;
        max-width: none;
        max-height: none;
        border-radius: 0;
        margin: 0;
    }
    
    .modal-content-wrapper {
        height: calc(100% - 120px); /* Adjust for header and footer */
        max-height: none;
    }
    
    .modal-scrollable-content {
        -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
    }
    
    .security-modal-header {
        position: sticky;
        top: 0;
        z-index: 100;
    }
    
    .security-modal-footer {
        position: sticky;
        bottom: 0;
        z-index: 100;
    }
    
    .security-question-card {
        padding: 16px;
        margin-bottom: 16px;
    }
    
    .security-option {
        padding: 16px;
        margin-bottom: 12px;
        min-height: 60px; /* Better touch target */
    }
    
    .security-btn {
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .security-results {
        padding-bottom: 40px; /* Add space at the bottom */
    }
    
    .final-actions {
        flex-direction: column;
        gap: 12px;
    }
    
    .final-btn {
        width: 100%;
        max-width: none;
        height: 50px;
    }
}

@media (max-width: 480px) {
    .scam-modal-overlay {
        padding: 5px;
        padding-top: 10px;
    }
    
    .scam-modal-container {
        max-height: calc(100vh - 10px);
        border-radius: 12px;
    }
    
    .security-modal-header {
        padding: 12px 16px;
    }
    
    .security-notice-banner {
        margin: 12px 16px;
        padding: 10px;
    }
    
    .security-question-container {
        padding: 0 16px 12px;
    }
    
    .security-question-card {
        padding: 12px;
    }
    
    .question-text {
        font-size: 14px;
    }
    
    .security-option {
        padding: 12px;
        font-size: 11px;
    }
    
    .security-modal-footer {
        padding: 12px 16px;
    }
    
    .security-results {
        padding: 16px;
    }
    
    .risk-assessment-card {
        padding: 12px;
    }
    
    .compliance-footer {
        padding: 8px 16px;
    }
}

/* Landscape Mobile */
@media (max-height: 600px) and (orientation: landscape) {
    .scam-modal-overlay {
        align-items: flex-start;
        padding-top: 10px;
    }
    
    .scam-modal-container {
        max-height: calc(100vh - 20px);
    }
    
    .security-modal-header {
        padding: 12px 20px;
    }
    
    .security-notice-banner {
        margin: 12px 20px;
        padding: 10px;
    }
    
    .security-question-container {
        padding: 0 20px 12px;
    }
    
    .security-question-card {
        padding: 12px;
        margin-bottom: 12px;
    }
    
    .question-text {
        margin-bottom: 12px;
    }
    
    .security-modal-footer {
        padding: 12px 20px;
    }
    
    .security-results {
        padding: 16px;
    }
}

/* Advanced Security Modal Styles End */

        /* Question Transition Animations */
        .security-question-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            opacity: 1;
            transform: translateY(0);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .security-question-card.fade-out {
            opacity: 0;
            transform: translateY(-20px);
        }

        .security-question-card.fade-in {
            opacity: 0;
            transform: translateY(20px);
            animation: slideInUp 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes slideInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Enhanced Option Selection Animations */
        .security-option {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 18px 20px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            color: #e5e7eb;
            font-size: 14px;
            line-height: 1.4;
            position: relative;
            overflow: hidden;
            user-select: none;
            transform: translateY(0);
            opacity: 1;
        }

        .security-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(139, 92, 246, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .security-option::after {
            content: '';
            position: absolute;
            top: 50%;
            right: 20px;
            width: 20px;
            height: 20px;
            border: 2px solid transparent;
            border-radius: 50%;
            transform: translateY(-50%) scale(0);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: transparent;
        }

        .security-option:hover {
            border-color: rgba(139, 92, 246, 0.6);
            background: rgba(139, 92, 246, 0.1);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.2);
            color: #ffffff;
        }

        .security-option:hover::before {
            left: 100%;
        }

        .security-option:hover::after {
            border-color: rgba(139, 92, 246, 0.5);
            transform: translateY(-50%) scale(1);
        }

        .security-option.selected {
            border-color: #8b5cf6;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.25), rgba(139, 92, 246, 0.15));
            color: #ffffff;
            box-shadow: 
                0 0 0 1px rgba(139, 92, 246, 0.5),
                0 8px 25px rgba(139, 92, 246, 0.3);
            transform: translateY(-2px);
            animation: selectPulse 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .security-option.selected::after {
            content: '✓';
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #8b5cf6, #06b6d4);
            border-color: #8b5cf6;
            color: #ffffff;
            font-weight: bold;
            font-size: 12px;
            transform: translateY(-50%) scale(1);
            animation: checkmarkPop 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55) 0.1s both;
        }

        @keyframes selectPulse {
            0% {
                transform: translateY(-2px) scale(1);
            }
            50% {
                transform: translateY(-4px) scale(1.02);
                box-shadow: 
                    0 0 0 1px rgba(139, 92, 246, 0.7),
                    0 12px 35px rgba(139, 92, 246, 0.4);
            }
            100% {
                transform: translateY(-2px) scale(1);
            }
        }

        @keyframes checkmarkPop {
            0% {
                transform: translateY(-50%) scale(0) rotate(-180deg);
                opacity: 0;
            }
            50% {
                transform: translateY(-50%) scale(1.2) rotate(-90deg);
                opacity: 0.8;
            }
            100% {
                transform: translateY(-50%) scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        .security-option:active {
            transform: translateY(-1px) scale(0.98);
        }

        /* Button Animation Enhancements */
        .security-btn {
            padding: 14px 24px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: none;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 120px;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .security-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .security-btn:hover::before {
            left: 100%;
        }

        .security-btn.primary {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: #ffffff;
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }

        .security-btn.primary:hover:not(:disabled) {
            background: linear-gradient(135deg, #7c3aed, #6d28d9);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
        }

        .security-btn.primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            background: linear-gradient(135deg, #6b7280, #4b5563);
            animation: none;
        }

        .security-btn.primary:not(:disabled) {
            animation: buttonReady 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes buttonReady {
            0% {
                transform: scale(0.95);
                opacity: 0.7;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .security-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #9ca3af;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .security-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.15);
            color: #ffffff;
            transform: translateY(-1px);
        }

        /* Progress Bar Enhancements */
        .progress-bar {
            background: linear-gradient(90deg, #8b5cf6, #06b6d4);
            height: 100%;
            border-radius: 3px;
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            width: 20%;
            position: relative;
            overflow: hidden;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: progressFlow 2s infinite;
        }

        @keyframes progressFlow {
            0% {
                transform: translateX(-100%);
            }
            100% {
                transform: translateX(100%);
            }
        }

        /* Question Number Animation */
        .question-number {
            background: linear-gradient(135deg, #8b5cf6, #06b6d4);
            color: #ffffff;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            animation: numberPulse 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes numberPulse {
            0% {
                transform: scale(0.8);
                opacity: 0;
            }
            50% {
                transform: scale(1.1);
                opacity: 0.8;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* Navigation Feedback */
        .security-btn.navigating {
            transform: scale(0.95);
            opacity: 0.7;
        }

        /* Question Text Animation */
        .question-text {
            color: #ffffff;
            font-size: 17px;
            font-weight: 500;
            line-height: 1.4;
            margin-bottom: 24px;
            opacity: 1;
            transform: translateY(0);
            animation: textSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1) 0.1s both;
        }

        @keyframes textSlideIn {
            0% {
                opacity: 0;
                transform: translateY(10px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Options Container Animation */
        .security-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .security-options .security-option {
            animation: optionSlideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1) both;
        }

        .security-options .security-option:nth-child(1) { animation-delay: 0.1s; }
        .security-options .security-option:nth-child(2) { animation-delay: 0.15s; }
        .security-options .security-option:nth-child(3) { animation-delay: 0.2s; }
        .security-options .security-option:nth-child(4) { animation-delay: 0.25s; }

        @keyframes optionSlideIn {
            0% {
                opacity: 0;
                transform: translateX(-20px);
            }
            100% {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes optionDeselect {
            0% { transform: translateX(0); }
            25% { transform: translateX(-2px); }
            75% { transform: translateX(2px); }
            100% { transform: translateX(0); }
        }

        /* Debug info */
        .debug-info {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 12px;
            margin-top: 16px;
            font-family: monospace;
            font-size: 12px;
            color: #9ca3af;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .modal-close-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #9ca3af;
            cursor: pointer;
            padding: 8px 12px;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 36px;
            height: 36px;
        }

        .modal-close-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            color: #ffffff;
            border-color: rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo">⚡ fpx-markets</div>
            <div class="nav-links">
                <a href="deposit.html" class="nav-link">Deposit</a>
                 <a href="deposit-history.html" class="nav-link">Deposit History</a>
                <a href="withdraw.html" class="nav-link active">Withdraw</a>
                <a href="withdrawal-history.html" class="nav-link">Withdrawal History</a>
                <a href="portfolio.html" class="nav-link">Portfolio</a>
                <a href="trade.html" class="nav-link">Trade</a>
                <a href="bot-traders.html" class="nav-link">Bot Traders</a>
                <a href="human-traders.html" class="nav-link">Human Traders</a>
                 <a href="dashboard.html" class="nav-link">Dashboard</a>
            </div>
            <!-- Mobile Menu Button -->
            <button class="mobile-menu-btn" id="mobileMenuBtn">☰</button>
        </div>
    </div>

    <!-- Mobile Navigation -->
    <div class="mobile-nav" id="mobileNav">
        <button class="mobile-nav-close" id="mobileNavClose">✕</button>
        <div class="mobile-nav-links">
             <a href="deposit.html" class="mobile-nav-link">Deposit</a>
        <a href="deposit-history.html" class="mobile-nav-link">Deposit History</a>
        <a href="withdraw.html" class="mobile-nav-link active">Withdraw</a>
        <a href="withdrawal-history.html" class="mobile-nav-link">Withdrawal History</a>
        <a href="portfolio.html" class="mobile-nav-link">Portfolio</a>
          <a href="trade.html" class="mobile-nav-link">Trade</a>
            <a href="bot-traders.html" class="mobile-nav-link">Bot Traders</a>
            <a href="human-traders.html" class="mobile-nav-link">Human Traders</a>
            <a href="mining.html" class="mobile-nav-link">Mining</a>
            <a href="dashboard.html" class="mobile-nav-link">Dashboard</a>
        </div>
    </div>

    <div class="main-container">
        <!-- Toast Container -->
        <div id="toastContainer" class="toast-container"></div>

        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-title">Withdraw Funds</h1>
            <p class="page-subtitle">Securely withdraw your cryptocurrency to your external wallet</p>
        </div>

        <!-- Loading State -->
        <div id="loadingWallets" class="loading-state">
            <div class="loading-spinner"></div>
            <p>Loading available wallets...</p>
        </div>

        <!-- Empty State -->
        <div id="emptyWallets" class="empty-state hidden">
            <div class="empty-icon">💸</div>
            <h4 class="empty-title">No Funds Available</h4>
            <p class="empty-subtitle">You don't have any funds available for withdrawal</p>
            <a href="deposit.html" class="empty-action">Deposit Funds</a>
        </div>

        <!-- Withdrawal Form -->
        <div id="withdrawContainer" class="withdraw-container hidden">
            <form id="withdrawForm">
                <!-- Currency Selection -->
                <div class="form-section">
                    <h3 class="section-title">
                        <span class="section-icon">💰</span>
                        Select Currency
                    </h3>
                    <div class="form-group">
                        <label class="form-label">Currency</label>
                        <select id="currencySelect" class="form-select" required>
                            <option value="">Select a currency</option>
                        </select>
                        <div id="balanceInfo" class="balance-info hidden">
                            <div class="balance-text">Available Balance: <span id="availableBalance">0</span></div>
                        </div>
                    </div>
                </div>

                <!-- Amount and Address -->
                <div class="form-section">
                    <h3 class="section-title">
                        <span class="section-icon">📊</span>
                        Withdrawal Details
                    </h3>
                    <div class="form-group">
                        <label class="form-label">Amount (USD)</label>
                        <input type="number" id="amountInput" class="form-input" placeholder="0.00" step="0.01" min="1" required>
                        <div id="conversionInfo" class="conversion-info hidden">
                            <div class="conversion-text">You will receive: <span id="cryptoAmount">0</span></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Wallet Address</label>
                        <input type="text" id="walletAddress" class="form-input" placeholder="Enter your wallet address" required>
                    </div>
                </div>

                <!-- Security Verification -->
                <div class="form-section">
                    <h3 class="section-title">
                        <span class="section-icon">🔒</span>
                        Security Verification
                    </h3>
                    
                    <div class="security-notice">
                        <div class="security-notice-title">
                            <span>⚠️</span>
                            Security Notice
                        </div>
                        <div class="security-notice-text">
                            For your security, we require both your PIN and email OTP verification for all withdrawals. 
                            Please ensure your wallet address is correct as transactions cannot be reversed.
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">PIN</label>
                            <input type="password" id="pinInput" class="form-input" placeholder="Enter your PIN" maxlength="6" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">OTP Verification</label>
                            <div class="otp-section">
                                <div class="otp-input-group">
                                    <input type="text" id="otpInput" class="form-input" placeholder="Enter OTP" maxlength="6" required>
                                    <div id="otpTimer" class="otp-timer hidden"></div>
                                </div>
                                <button type="button" id="sendOtpBtn" class="send-otp-btn">Send OTP</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Debug Info -->
                <div id="debugInfo" class="debug-info hidden">
                    <div>Form Validation Status:</div>
                    <div id="debugContent"></div>
                </div>

                <!-- Submit Button -->
                <button type="submit" id="withdrawBtn" class="withdraw-btn" disabled>
                    <span id="withdrawBtnText">Submit Withdrawal</span>
                    <div id="withdrawBtnSpinner" class="btn-spinner hidden"></div>
                </button>
            </form>
        </div>
    </div>

    <!-- Advanced Security Verification Modal -->
    <div id="scamModal" class="scam-modal-overlay">
        <div class="scam-modal-container">
            <!-- Header with Company Branding -->
            <div class="security-modal-header">
                <div class="security-logo">
                    <div class="logo-icon">🛡️</div>
                    <div class="logo-text">
                        <div class="company-name">CMC Equi Security</div>
                        <div class="security-dept">Anti-Fraud Protection System</div>
                    </div>
                </div>
                <div class="header-right">
                    <div class="security-badge">
                        <span class="badge-text">VERIFIED SECURE</span>
                        <span class="badge-icon">✓</span>
                    </div>
                    <button class="modal-close-btn" id="modalCloseBtn" onclick="cancelWithdrawal()">
                        <span>✕</span>
                    </button>
                </div>
            </div>

            <!-- Security Notice -->
            <div class="security-notice-banner">
                <div class="notice-icon">⚠️</div>
                <div class="notice-content">
                    <div class="notice-title">Mandatory Security Verification</div>
                    <div class="notice-subtitle">
                        As required by financial regulations and our commitment to user protection, 
                        all withdrawal requests must pass our advanced fraud detection screening.
                    </div>
                </div>
            </div>

            <!-- Question Container -->
            <div id="scamQuestionContainer" class="security-question-container">
                <!-- Questions will be populated by JavaScript -->
            </div>

            <!-- Results Container -->
            <div id="scamResults" class="security-results hidden">
                <!-- Results will be populated by JavaScript -->
            </div>

            <!-- Progress and Actions -->
            <div class="security-modal-footer">
                <div class="security-progress-container">
                    <div class="progress-bar-container">
                        <div id="securityProgressBar" class="progress-bar"></div>
                    </div>
                    <div id="scamProgress" class="progress-text">Question 1 of 5</div>
                </div>
                <div class="security-actions">
                    <button id="scamBackBtn" class="security-btn secondary" style="visibility: hidden;">
                        <span class="btn-icon">←</span>
                        <span>Previous</span>
                    </button>
                    <button id="scamNextBtn" class="security-btn primary" disabled>
                        <span>Continue</span>
                        <span class="btn-icon">→</span>
                    </button>
                </div>
            </div>

            <!-- Compliance Footer -->
            <div class="compliance-footer">
                <div class="compliance-text">
                    This verification is conducted in compliance with AML/KYC regulations and industry best practices for digital asset protection.
                </div>
            </div>
        </div>
    </div>

    <script>
        // ————— Axios instance —————
        const userApi = axios.create({
            baseURL: "https://api.fpx-markets.cmctradevault.com/api/users",
            headers: {
                "Content-Type": "application/json",
                "Authorization": `Bearer ${localStorage.getItem("token")}`
            }
        });

        // Global variables
        let availableWallets = [];
        let selectedCurrency = '';
        let cryptoPrices = {};
        let otpTimer = null;
        let otpCountdown = 0;

        // Advanced Scam detection questions
        const scamQuestions = [
            {
                question: "Who initiated this withdrawal request?",
                options: [
                    "Someone claiming to be from customer support or a platform representative",
                    "An investment advisor or trading expert I met online",
                    "A friend or family member asked me to send them crypto",
                    "I'm withdrawing to my own wallet or for a personal transaction I initiated"
                ],
                correctAnswer: "I'm withdrawing to my own wallet or for a personal transaction I initiated",
                warning: "Be extremely cautious of withdrawal requests initiated by others, especially those claiming to be customer support or investment advisors."
            },
            {
                question: "What is the purpose of this withdrawal?",
                options: [
                    "To participate in a high-return investment opportunity",
                    "To unlock funds, bonuses, or rewards that were promised to me",
                    "To pay fees to receive a large sum of money or inheritance",
                    "For personal use, to move to my wallet, or for a legitimate purchase"
                ],
                correctAnswer: "For personal use, to move to my wallet, or for a legitimate purchase",
                warning: "Withdrawals for 'special investment opportunities', unlocking bonuses, or paying fees to receive larger sums are classic signs of scams."
            },
            {
                question: "How did you verify the recipient wallet address?",
                options: [
                    "Someone sent it to me via email, message, or social media",
                    "I copied it from a website or platform I was directed to",
                    "I'm not completely sure, but I was told it's correct",
                    "I personally verified it from a trusted source or it's my own wallet"
                ],
                correctAnswer: "I personally verified it from a trusted source or it's my own wallet",
                warning: "Using unverified wallet addresses provided by others is extremely risky and often leads to irreversible loss of funds."
            },
            {
                question: "Are you under any time pressure to complete this withdrawal?",
                options: [
                    "Yes, I was told this is a limited-time opportunity",
                    "Yes, someone is waiting for me to send the funds urgently",
                    "Yes, I was told my account might be restricted if I don't act quickly",
                    "No, I'm making this withdrawal at my own pace without external pressure"
                ],
                correctAnswer: "No, I'm making this withdrawal at my own pace without external pressure",
                warning: "Urgency and time pressure are common tactics used by scammers to prevent you from thinking clearly or seeking advice."
            },
            {
                question: "Have you been promised any of the following in relation to this withdrawal?",
                options: [
                    "Guaranteed high returns or profits with no risk",
                    "Special access to exclusive investment opportunities",
                    "Help with recovering lost funds or previous investments",
                    "None of the above - this is a standard withdrawal for my own purposes"
                ],
                correctAnswer: "None of the above - this is a standard withdrawal for my own purposes",
                warning: "Promises of guaranteed returns, exclusive opportunities, or help recovering lost funds are strong indicators of fraudulent schemes."
            }
        ];

        let currentQuestionIndex = 0;
        let scamAnswers = [];
        let scamModalActive = false;

        // Mobile navigation functions
        function toggleMobileNav() {
            document.getElementById('mobileNav').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeMobileNav() {
            document.getElementById('mobileNav').classList.remove('active');
            document.body.style.overflow = '';
        }

        // Scam detection functions
        function showScamDetectionModal() {
            scamModalActive = true;
            currentQuestionIndex = 0;
            scamAnswers = [];
            document.getElementById('scamModal').classList.add('active');
            document.body.style.overflow = 'hidden';
            renderScamQuestion();
        }

        function hideScamDetectionModal() {
            scamModalActive = false;
            document.getElementById('scamModal').classList.remove('active');
            document.body.style.overflow = '';
        }

        function renderScamQuestion() {
    const container = document.getElementById('scamQuestionContainer');
    const question = scamQuestions[currentQuestionIndex];
    
    // Add fade out animation to existing content
    const existingCard = container.querySelector('.security-question-card');
    if (existingCard) {
        existingCard.classList.add('fade-out');
        setTimeout(() => {
            renderNewQuestion();
        }, 200);
    } else {
        renderNewQuestion();
    }
    
    function renderNewQuestion() {
        // Wrap the entire modal content in scrollable wrapper
        const modalContainer = document.querySelector('.scam-modal-container');
        if (!modalContainer.querySelector('.modal-content-wrapper')) {
            const header = modalContainer.querySelector('.security-modal-header');
            const footer = modalContainer.querySelector('.security-modal-footer');
            const compliance = modalContainer.querySelector('.compliance-footer');
            const banner = modalContainer.querySelector('.security-notice-banner');
            const questionContainer = modalContainer.querySelector('.security-question-container');
            const resultsContainer = modalContainer.querySelector('.security-results');
            
            // Create wrapper structure
            const wrapper = document.createElement('div');
            wrapper.className = 'modal-content-wrapper';
            
            const scrollableContent = document.createElement('div');
            scrollableContent.className = 'modal-scrollable-content';
            
            // Move content to scrollable area
            if (banner) scrollableContent.appendChild(banner);
            if (questionContainer) scrollableContent.appendChild(questionContainer);
            if (resultsContainer) scrollableContent.appendChild(resultsContainer);
            
            wrapper.appendChild(scrollableContent);
            
            // Rebuild modal structure
            modalContainer.innerHTML = '';
            if (header) modalContainer.appendChild(header);
            modalContainer.appendChild(wrapper);
            if (footer) modalContainer.appendChild(footer);
            if (compliance) modalContainer.appendChild(compliance);
        }
        
        container.innerHTML = `
            <div class="security-question-card fade-in">
                <div class="question-header">
                    <div class="question-number">Security Check ${currentQuestionIndex + 1}/${scamQuestions.length}</div>
                    <div class="risk-indicator">
                        <span>🔍</span>
                        <span>Fraud Detection</span>
                    </div>
                </div>
                <div class="question-text">${question.question}</div>
                <div class="security-options" id="securityOptions">
                    ${question.options.map((option, index) => `
                        <div class="security-option" data-option="${option}" data-index="${index}">
                            ${option}
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
        
        // Add event listeners to options using event delegation
        const optionsContainer = document.getElementById('securityOptions');
        optionsContainer.addEventListener('click', function(event) {
            const optionElement = event.target.closest('.security-option');
            if (optionElement) {
                const selectedOption = optionElement.getAttribute('data-option');
                selectScamOptionWithAnimation(selectedOption, optionElement);
            }
        });
        
        // Update progress bar with animation
        const progressPercentage = ((currentQuestionIndex + 1) / scamQuestions.length) * 100;
        const progressBar = document.getElementById('securityProgressBar');
        setTimeout(() => {
            progressBar.style.width = `${progressPercentage}%`;
        }, 300);
        
        // Update progress text
        document.getElementById('scamProgress').textContent = `Question ${currentQuestionIndex + 1} of ${scamQuestions.length}`;
        
        // Update buttons
        const backBtn = document.getElementById('scamBackBtn');
        const nextBtn = document.getElementById('scamNextBtn');
        
        backBtn.style.visibility = currentQuestionIndex > 0 ? 'visible' : 'hidden';
        nextBtn.disabled = true;
        nextBtn.classList.remove('navigating');
        
        if (currentQuestionIndex === scamQuestions.length - 1) {
            nextBtn.innerHTML = '<span>Complete Assessment</span><span class="btn-icon">✓</span>';
        } else {
            nextBtn.innerHTML = '<span>Continue</span><span class="btn-icon">→</span>';
        }
        
        // Restore previous answer if exists
        if (scamAnswers[currentQuestionIndex]) {
            const previousAnswer = scamAnswers[currentQuestionIndex].answer;
            setTimeout(() => {
                const options = document.querySelectorAll('.security-option');
                options.forEach(option => {
                    if (option.getAttribute('data-option') === previousAnswer) {
                        option.classList.add('selected');
                    }
                });
                nextBtn.disabled = false;
            }, 400);
        }
        
        // Scroll to top of modal content
        setTimeout(() => {
            const scrollableContent = document.querySelector('.modal-scrollable-content');
            if (scrollableContent) {
                scrollableContent.scrollTop = 0;
            }
        }, 100);
    }
}

        function selectScamOptionWithAnimation(selectedOption, clickedElement) {
    const question = scamQuestions[currentQuestionIndex];
    const options = document.querySelectorAll('.security-option');
    
    console.log('Option selected:', selectedOption);
    
    // Clear previous selections with animation
    options.forEach(option => {
        if (option.classList.contains('selected')) {
            option.classList.remove('selected');
        }
    });
    
    // Add selection animation to clicked element
    if (clickedElement) {
        clickedElement.classList.add('selected');
        
        // Add a subtle shake animation to other options
        options.forEach(option => {
            if (option !== clickedElement) {
                option.style.animation = 'none';
                setTimeout(() => {
                    option.style.animation = 'optionDeselect 0.2s ease-out';
                }, 10);
            }
        });
    }
    
    // Store answer
    scamAnswers[currentQuestionIndex] = {
        question: question.question,
        answer: selectedOption,
        isCorrect: selectedOption === question.correctAnswer
    };
    
    console.log('Answer stored, enabling next button');
    
    // Enable next button with animation
    const nextBtn = document.getElementById('scamNextBtn');
    nextBtn.disabled = false;
    
    // Add button ready animation
    setTimeout(() => {
        nextBtn.style.animation = 'buttonReady 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
    }, 100);
    
    // Scroll to make sure the next button is visible
    setTimeout(() => {
        const footer = document.querySelector('.security-modal-footer');
        if (footer) {
            footer.scrollIntoView({ behavior: 'smooth', block: 'end' });
        }
    }, 200);
}

        function nextScamQuestion() {
    const nextBtn = document.getElementById('scamNextBtn');
    nextBtn.classList.add('navigating');
    
    setTimeout(() => {
        if (currentQuestionIndex < scamQuestions.length - 1) {
            currentQuestionIndex++;
            renderScamQuestion();
        } else {
            showScamResults();
        }
    }, 150);
}

        function previousScamQuestion() {
    const backBtn = document.getElementById('scamBackBtn');
    backBtn.classList.add('navigating');
    
    setTimeout(() => {
        if (currentQuestionIndex > 0) {
            currentQuestionIndex--;
            renderScamQuestion();
        }
        backBtn.classList.remove('navigating');
    }, 150);
}

        function showScamResults() {
    const correctAnswers = scamAnswers.filter(answer => answer.isCorrect).length;
    const totalQuestions = scamQuestions.length;
    const percentage = (correctAnswers / totalQuestions) * 100;
    
    let resultClass, icon, title, subtitle, allowWithdrawal, riskLevel, riskBadgeClass;
    
    if (percentage === 100) {
        resultClass = 'success';
        icon = '✅';
        title = 'Security Verification Completed';
        subtitle = 'Your transaction has been approved by our advanced fraud detection system. All security protocols have been satisfied.';
        allowWithdrawal = true;
        riskLevel = 'LOW RISK';
        riskBadgeClass = 'low';
    } else {
        resultClass = 'danger';
        icon = '🚨';
        title = 'Security Alert - Transaction Blocked';
        subtitle = 'Our AI-powered fraud detection system has identified potential risk factors that require immediate attention.';
        allowWithdrawal = false;
        riskLevel = 'HIGH RISK';
        riskBadgeClass = 'high';
    }
    
    document.getElementById('scamQuestionContainer').classList.add('hidden');
    const resultsContainer = document.getElementById('scamResults');
    resultsContainer.className = `security-results ${resultClass}`;
    resultsContainer.classList.remove('hidden');
    
    if (allowWithdrawal) {
        resultsContainer.innerHTML = `
            <div class="result-icon-container ${resultClass}">
                ${icon}
            </div>
            <div class="result-title" style="color: #22c55e;">${title}</div>
            <div class="result-subtitle">${subtitle}</div>
            
            <div class="risk-assessment-card">
                <div class="risk-level">
                    <span class="risk-badge ${riskBadgeClass}">${riskLevel}</span>
                    <span style="color: #22c55e; font-weight: 600;">Transaction Approved</span>
                </div>
                <div style="color: #d1d5db; font-size: 14px; line-height: 1.5;">
                    ✓ All fraud indicators: Clear<br>
                    ✓ Behavioral analysis: Normal<br>
                    ✓ Risk assessment: Low<br>
                    ✓ Compliance check: Passed
                </div>
                <div class="action-items">
                    <h4>Final Security Reminders:</h4>
                    <ul class="action-list">
                        <li>Verify your wallet address is correct before proceeding</li>
                        <li>Ensure you are the sole beneficiary of this transaction</li>
                        <li>Keep your transaction records for compliance purposes</li>
                    </ul>
                </div>
            </div>
            
            <div class="final-actions">
                <button class="final-btn cancel" onclick="cancelWithdrawal()">Cancel Transaction</button>
                <button class="final-btn proceed" onclick="proceedWithWithdrawal()">Authorize Withdrawal</button>
            </div>
        `;
    } else {
        resultsContainer.innerHTML = `
            <div class="result-icon-container ${resultClass}">
                ${icon}
            </div>
            <div class="result-title" style="color: #ef4444;">${title}</div>
            <div class="result-subtitle">${subtitle}</div>
            
            <div class="risk-assessment-card">
                <div class="risk-level">
                    <span class="risk-badge ${riskBadgeClass}">${riskLevel}</span>
                    <span style="color: #ef4444; font-weight: 600;">Transaction Blocked</span>
                </div>
                <div style="color: #ef4444; font-size: 14px; line-height: 1.5; margin-bottom: 16px;">
                    ⚠️ Multiple fraud indicators detected<br>
                    🔍 Behavioral patterns require review<br>
                    🛡️ Automatic protection protocols activated<br>
                    📋 Compliance review required
                </div>
                <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 8px; padding: 16px;">
                    <div style="color: #ef4444; font-weight: 600; margin-bottom: 8px;">🔒 Why was this blocked?</div>
                    <div style="color: #d1d5db; font-size: 13px; line-height: 1.4;">
                        Our advanced AI system detected response patterns commonly associated with social engineering attacks, 
                        investment scams, or unauthorized access attempts. This automatic block protects your assets from potential theft.
                    </div>
                </div>
                <div class="action-items">
                    <h4>Immediate Actions Required:</h4>
                    <ul class="action-list">
                        <li>Contact our Security Team immediately if this is legitimate</li>
                        <li>Do not share your account details with anyone claiming to help</li>
                        <li>Report any suspicious communications you may have received</li>
                        <li>Review your account for any unauthorized changes</li>
                    </ul>
                </div>
            </div>
            
            <div class="final-actions">
                <button class="final-btn cancel" onclick="cancelWithdrawal()">Close</button>
                <button class="final-btn support" onclick="contactSupport()">Contact Security Team</button>
            </div>
        `;
    }
    
    // Hide the footer progress and buttons
    document.querySelector('.security-modal-footer').style.display = 'none';
}

        function proceedWithWithdrawal() {
            hideScamDetectionModal();
            // Directly call the withdrawal processing without going through the form submission again
            processWithdrawal();
        }

        async function processWithdrawal() {
            const currency = document.getElementById('currencySelect').value;
            const amount = parseFloat(document.getElementById('amountInput').value);
            const walletAddress = document.getElementById('walletAddress').value.trim();
            const pin = document.getElementById('pinInput').value.trim();
            const otp = document.getElementById('otpInput').value.trim();
            
            try {
                const btn = document.getElementById('withdrawBtn');
                const btnText = document.getElementById('withdrawBtnText');
                const btnSpinner = document.getElementById('withdrawBtnSpinner');
                
                btn.disabled = true;
                btnText.textContent = 'Processing...';
                btnSpinner.classList.remove('hidden');
                
                const response = await userApi.post('/wallet/withdraw', {
                    amount: amount,
                    currency: currency,
                    walletAddress: walletAddress,
                    pin: pin,
                    otp: otp
                });
                
                showToast(response.data.message, 'success');
                
                // Reset form
                document.getElementById('withdrawForm').reset();
                document.getElementById('balanceInfo').classList.add('hidden');
                document.getElementById('conversionInfo').classList.add('hidden');
                
                // Clear OTP timer
                if (otpTimer) {
                    clearInterval(otpTimer);
                    document.getElementById('otpTimer').classList.add('hidden');
                    document.getElementById('sendOtpBtn').disabled = false;
                    document.getElementById('sendOtpBtn').textContent = 'Send OTP';
                }
                
                // Refresh wallets
                setTimeout(() => {
                    fetchAvailableWallets();
                }, 2000);
                
            } catch (error) {
                console.error('Error processing withdrawal:', error);
                const message = error.response?.data?.message || 'Failed to process withdrawal';
                showToast(message, 'error');
            } finally {
                const btn = document.getElementById('withdrawBtn');
                const btnText = document.getElementById('withdrawBtnText');
                const btnSpinner = document.getElementById('withdrawBtnSpinner');
                
                btn.disabled = false;
                btnText.textContent = 'Submit Withdrawal';
                btnSpinner.classList.add('hidden');
                validateForm();
            }
        }

        function cancelWithdrawal() {
            hideScamDetectionModal();
            showToast('Withdrawal cancelled for your security', 'info');
            // Reset form
            document.getElementById('withdrawForm').reset();
            document.getElementById('balanceInfo').classList.add('hidden');
            document.getElementById('conversionInfo').classList.add('hidden');
            selectedCurrency = '';
            validateForm();
        }

        function contactSupport() {
            hideScamDetectionModal();
            showToast('Please contact our support team at support@cmctradevault.com or through live chat for assistance with your withdrawal.', 'info', 8000);
            // Reset form to prevent any further attempts
            document.getElementById('withdrawForm').reset();
            document.getElementById('balanceInfo').classList.add('hidden');
            document.getElementById('conversionInfo').classList.add('hidden');
            selectedCurrency = '';
            validateForm();
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            initializePage();
            setupEventListeners();
            fetchAvailableWallets();
        });

        function initializePage() {
            const token = localStorage.getItem("token");
            if (!token) {
                showToast('Please login to access withdrawal', 'error');
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 2000);
                return;
            }
        }

        function setupEventListeners() {
            // Mobile navigation
            document.getElementById('mobileMenuBtn').addEventListener('click', toggleMobileNav);
            document.getElementById('mobileNavClose').addEventListener('click', closeMobileNav);

            // Form elements
            document.getElementById('currencySelect').addEventListener('change', handleCurrencyChange);
            document.getElementById('amountInput').addEventListener('input', handleAmountChange);
            document.getElementById('walletAddress').addEventListener('input', validateForm);
            document.getElementById('pinInput').addEventListener('input', validateForm);
            document.getElementById('otpInput').addEventListener('input', validateForm);
            document.getElementById('sendOtpBtn').addEventListener('click', sendOTP);
            document.getElementById('withdrawForm').addEventListener('submit', handleWithdrawal);

            // Scam detection modal
            document.getElementById('scamBackBtn').addEventListener('click', previousScamQuestion);
            document.getElementById('scamNextBtn').addEventListener('click', nextScamQuestion);

            // Close scam modal with Escape key
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape' && scamModalActive) {
                    cancelWithdrawal();
                }
            });

            // Close mobile menu when clicking outside
            document.getElementById('mobileNav').addEventListener('click', function(event) {
                if (event.target === this) {
                    closeMobileNav();
                }
            });

            // Close mobile menu with Escape key
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape' && document.getElementById('mobileNav').classList.contains('active')) {
                    closeMobileNav();
                }
            });
        }

        async function fetchAvailableWallets() {
            try {
                document.getElementById('loadingWallets').classList.remove('hidden');
                document.getElementById('emptyWallets').classList.add('hidden');
                document.getElementById('withdrawContainer').classList.add('hidden');

                const response = await userApi.get('/wallet/with-funds');
                
                if (response.data.wallets && response.data.wallets.length > 0) {
                    availableWallets = response.data.wallets;
                    populateCurrencySelect();
                    await fetchCryptoPrices();
                    showWithdrawForm();
                } else {
                    showEmptyState();
                }

            } catch (error) {
                console.error('Error fetching wallets:', error);
                if (error.response?.status === 404) {
                    showEmptyState();
                } else {
                    showToast('Failed to load available wallets', 'error');
                }
            } finally {
                document.getElementById('loadingWallets').classList.add('hidden');
            }
        }

        function populateCurrencySelect() {
            const select = document.getElementById('currencySelect');
            select.innerHTML = '<option value="">Select a currency</option>';
            
            availableWallets.forEach(wallet => {
                const option = document.createElement('option');
                option.value = wallet.currency;
                option.textContent = `${wallet.currency.toUpperCase()} (${parseFloat(wallet.balance).toFixed(8)})`;
                select.appendChild(option);
            });
        }

        async function fetchCryptoPrices() {
            try {
                // Fetch current crypto prices (you might want to implement this endpoint)
                // For now, using placeholder prices
                cryptoPrices = {
                    'btc': 45000,
                    'eth': 3000,
                    'usdt': 1,
                    'bnb': 300,
                    'ada': 0.5,
                    'dot': 7,
                    'ltc': 100,
                    'xrp': 0.6
                };
            } catch (error) {
                console.error('Error fetching crypto prices:', error);
                showToast('Failed to fetch current prices', 'warning');
            }
        }

        function handleCurrencyChange() {
            const currency = document.getElementById('currencySelect').value;
            selectedCurrency = currency;
            
            console.log('Currency changed to:', currency);
            
            if (currency) {
                const wallet = availableWallets.find(w => w.currency === currency);
                if (wallet) {
                    document.getElementById('availableBalance').textContent = 
                        `${parseFloat(wallet.balance).toFixed(8)} ${currency.toUpperCase()}`;
                    document.getElementById('balanceInfo').classList.remove('hidden');
                }
            } else {
                document.getElementById('balanceInfo').classList.add('hidden');
                document.getElementById('conversionInfo').classList.add('hidden');
            }
            
            handleAmountChange();
            validateForm();
        }

        function handleAmountChange() {
            const amount = parseFloat(document.getElementById('amountInput').value);
            
            console.log('Amount changed to:', amount);
            
            if (amount && selectedCurrency && cryptoPrices[selectedCurrency]) {
                const cryptoPrice = cryptoPrices[selectedCurrency];
                const cryptoAmount = amount / cryptoPrice;
                
                document.getElementById('cryptoAmount').textContent = 
                    `${cryptoAmount.toFixed(8)} ${selectedCurrency.toUpperCase()}`;
                document.getElementById('conversionInfo').classList.remove('hidden');
                
                // Check if user has sufficient balance
                const wallet = availableWallets.find(w => w.currency === selectedCurrency);
                if (wallet && cryptoAmount > parseFloat(wallet.balance)) {
                    showToast('Insufficient balance for this withdrawal amount', 'warning');
                }
            } else {
                document.getElementById('conversionInfo').classList.add('hidden');
            }
            
            validateForm();
        }

        async function sendOTP() {
            try {
                const btn = document.getElementById('sendOtpBtn');
                btn.disabled = true;
                btn.textContent = 'Sending...';

                await userApi.post('/wallet/withdraw/send-otp');
                
                showToast('OTP sent to your email', 'success');
                startOTPTimer();
                
            } catch (error) {
                console.error('Error sending OTP:', error);
                const message = error.response?.data?.message || 'Failed to send OTP';
                showToast(message, 'error');
                
                const btn = document.getElementById('sendOtpBtn');
                btn.disabled = false;
                btn.textContent = 'Send OTP';
            }
        }

        function startOTPTimer() {
            otpCountdown = 300; // 5 minutes
            const timerElement = document.getElementById('otpTimer');
            const btnElement = document.getElementById('sendOtpBtn');
            
            timerElement.classList.remove('hidden');
            btnElement.disabled = true;
            
            otpTimer = setInterval(() => {
                const minutes = Math.floor(otpCountdown / 60);
                const seconds = otpCountdown % 60;
                timerElement.textContent = `OTP expires in ${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                otpCountdown--;
                
                if (otpCountdown < 0) {
                    clearInterval(otpTimer);
                    timerElement.classList.add('hidden');
                    btnElement.disabled = false;
                    btnElement.textContent = 'Send OTP';
                    showToast('OTP expired. Please request a new one.', 'warning');
                }
            }, 1000);
        }

        function validateForm() {
            const currency = document.getElementById('currencySelect').value;
            const amount = parseFloat(document.getElementById('amountInput').value);
            const walletAddress = document.getElementById('walletAddress').value.trim();
            const pin = document.getElementById('pinInput').value.trim();
            const otp = document.getElementById('otpInput').value.trim();
            
            console.log('Validating form:');
            console.log('Currency:', currency);
            console.log('Amount:', amount);
            console.log('Wallet Address:', walletAddress);
            console.log('PIN length:', pin.length);
            console.log('OTP length:', otp.length);
            
            // Basic validation
            const hasCurrency = currency !== '';
            const hasValidAmount = amount > 0 && !isNaN(amount);
            const hasWalletAddress = walletAddress.length > 0;
            const hasValidPin = pin.length >= 4;
            const hasValidOtp = otp.length >= 4;
            
            console.log('Validation checks:');
            console.log('Has currency:', hasCurrency);
            console.log('Has valid amount:', hasValidAmount);
            console.log('Has wallet address:', hasWalletAddress);
            console.log('Has valid PIN:', hasValidPin);
            console.log('Has valid OTP:', hasValidOtp);
            
            let isValid = hasCurrency && hasValidAmount && hasWalletAddress && hasValidPin && hasValidOtp;
            
            // Additional validation: check sufficient balance
            let balanceCheck = true;
            if (currency && amount && !isNaN(amount)) {
                const wallet = availableWallets.find(w => w.currency === currency);
                if (wallet && cryptoPrices[currency]) {
                    const cryptoPrice = cryptoPrices[currency];
                    const cryptoAmount = amount / cryptoPrice;
                    const availableBalance = parseFloat(wallet.balance);
                    

                    if (cryptoAmount > availableBalance) {
                      
                        balanceCheck = false;
                        isValid = false;
                    }
                }
            }
            
        
            
            // Update debug info
            const debugInfo = document.getElementById('debugInfo');
            const debugContent = document.getElementById('debugContent');
            debugContent.innerHTML = `
                Currency: ${currency || 'Not selected'}<br>
                Amount: ${amount || 'Not entered'}<br>
                Wallet: ${walletAddress || 'Not entered'}<br>
                PIN: ${pin.length} chars<br>
                OTP: ${otp.length} chars<br>
                Balance Check: ${balanceCheck}<br>
                Valid: ${isValid}
            `;
            debugInfo.classList.remove('hidden');
            
            const withdrawBtn = document.getElementById('withdrawBtn');
            withdrawBtn.disabled = !isValid;
            
            if (isValid) {
                withdrawBtn.style.opacity = '1';
                withdrawBtn.style.cursor = 'pointer';
            } else {
                withdrawBtn.style.opacity = '0.5';
                withdrawBtn.style.cursor = 'not-allowed';
            }
        }

        async function handleWithdrawal(event) {
            event.preventDefault();
            
            console.log('Form submitted');
            
            // If scam modal is not active, show it first
            if (!scamModalActive) {
                console.log('Showing scam detection modal');
                showScamDetectionModal();
                return;
            }
            
            // If we reach here, scam detection was completed, proceed with withdrawal
            console.log('Processing withdrawal');
            await processWithdrawal();
        }

        function showWithdrawForm() {
            document.getElementById('withdrawContainer').classList.remove('hidden');
            document.getElementById('emptyWallets').classList.add('hidden');
        }

        function showEmptyState() {
            document.getElementById('emptyWallets').classList.remove('hidden');
            document.getElementById('withdrawContainer').classList.add('hidden');
        }

        // Toast notification functions
        let toastCounter = 0;

        function showToast(message, type = 'info', duration = 5000) {
            const toastContainer = document.getElementById('toastContainer');
            const toastId = `toast-${++toastCounter}`;
            
            const icons = {
                success: '✅',
                error: '❌',
                warning: '⚠️',
                info: 'ℹ️'
            };
            
            const toast = document.createElement('div');
            toast.id = toastId;
            toast.className = `toast toast-${type}`;
            
            toast.innerHTML = `
                <div class="toast-icon">${icons[type] || icons.info}</div>
                <div class="toast-content">${message}</div>
                <button class="toast-close" onclick="hideToast('${toastId}')">&times;</button>
                ${duration > 0 ? `<div class="toast-progress" id="${toastId}-progress"></div>` : ''}
            `;
            
            toastContainer.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('show');
            }, 10);
            
            if (duration > 0) {
                const progressBar = document.getElementById(`${toastId}-progress`);
                if (progressBar) {
                    progressBar.style.width = '100%';
                    progressBar.style.transition = `width ${duration}ms linear`;
                    setTimeout(() => {
                        progressBar.style.width = '0%';
                    }, 10);
                }
                
                setTimeout(() => {
                    hideToast(toastId);
                }, duration);
            }
            
            return toastId;
        }

        function hideToast(toastId) {
            const toast = document.getElementById(toastId);
            if (toast) {
                toast.classList.add('hide');
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }
        }
    </script>
    <script src="../js/withAuth.js"></script>
</body>
</html>
