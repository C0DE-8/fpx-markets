<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard - fpx-markets</title>
<!-- Add Chart.js library -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  /* CSS Reset and Base Styles */
  :root {
    --bg-primary: #0a0e1a;
    --bg-secondary: #1a1f2e;
    --bg-tertiary: #2a3441;
    --accent-primary: #8b5cf6;
    --accent-secondary: #06b6d4;
    --text-primary: #ffffff;
    --text-secondary: #9ca3af;
    --text-muted: #6b7280;
    --success: #22c55e;
    --warning: #f59e0b;
    --danger: #ef4444;
    --info: #0ea5e9;
    --border-color: #2a3441;
    --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.1);
    --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.2);
    --transition: all 0.2s ease;
    --sidebar-width: 280px;
    --header-height: 70px;
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    background: var(--bg-primary);
    color: var(--text-primary);
    line-height: 1.6;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Dashboard Layout */
  .dashboard {
    display: flex;
    min-height: 100vh;
  }

  /* Sidebar */
  .sidebar {
    width: var(--sidebar-width);
    background: var(--bg-secondary);
    border-right: 1px solid var(--border-color);
    height: 100vh;
    position: fixed;
    top: 0;
    left: 0;
    z-index: 1000;
    transition: transform 0.3s ease;
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: var(--accent-primary) var(--bg-secondary);
  }

  .sidebar::-webkit-scrollbar {
    width: 6px;
  }

  .sidebar::-webkit-scrollbar-track {
    background: var(--bg-secondary);
  }

  .sidebar::-webkit-scrollbar-thumb {
    background-color: var(--accent-primary);
    border-radius: 6px;
  }

  .sidebar-header {
    padding: 1.5rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 1px solid var(--border-color);
  }

  .logo {
    font-size: 24px;
    font-weight: 700;
    color: var(--accent-primary);
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .logo-icon {
    width: 32px;
    height: 32px;
    background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
  }

  .sidebar-content {
    padding: 1.5rem 0;
  }

  .sidebar-section {
    margin-bottom: 1.5rem;
  }

  .sidebar-section-title {
    padding: 0 1.5rem;
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--text-muted);
    margin-bottom: 0.75rem;
    font-weight: 600;
  }

  .nav-list {
    list-style: none;
  }

  .nav-item {
    margin-bottom: 0.25rem;
  }

  .nav-link {
    display: flex;
    align-items: center;
    padding: 0.75rem 1.5rem;
    color: var(--text-secondary);
    text-decoration: none;
    transition: var(--transition);
    border-radius: 0;
  }

  .nav-link:hover {
    background: rgba(139, 92, 246, 0.1);
    color: var(--text-primary);
  }

  .nav-link.active {
    background: rgba(139, 92, 246, 0.1);
    color: var(--accent-primary);
    border-right: 3px solid var(--accent-primary);
  }

  .nav-icon {
    margin-right: 0.75rem;
    font-size: 1.25rem;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .nav-text {
    flex: 1;
    font-weight: 500;
  }

  .nav-badge {
    background: var(--accent-primary);
    color: white;
    font-size: 0.75rem;
    font-weight: 600;
    padding: 0.125rem 0.5rem;
    border-radius: 12px;
    min-width: 20px;
    text-align: center;
  }

  .logout-btn {
    background: var(--danger);
    color: white;
    border: none;
    padding: 0.75rem 1.5rem;
    margin: 1rem 1.5rem;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .logout-btn:hover {
    background: #dc2626;
    transform: translateY(-2px);
  }

  /* Main Content */
  .main-content {
    flex: 1;
    margin-left: var(--sidebar-width);
    transition: margin-left 0.3s ease;
    min-height: 100vh;
  }

  .header {
    height: var(--header-height);
    background: var(--bg-secondary);
    border-bottom: 1px solid var(--border-color);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 2rem;
    position: sticky;
    top: 0;
    z-index: 50;
  }

  .header-left {
    display: flex;
    align-items: center;
  }

  .mobile-toggle {
    display: none;
    margin-right: 1rem;
    color: var(--text-muted);
    font-size: 1.5rem;
    cursor: pointer;
    background: none;
    border: none;
  }

  .header-right {
    display: flex;
    align-items: center;
    gap: 1.5rem;
  }

  .header-icon {
    color: var(--text-muted);
    font-size: 1.25rem;
    position: relative;
    transition: var(--transition);
    background: none;
    border: none;
    cursor: pointer;
  }

  .header-icon:hover {
    color: var(--text-primary);
  }

  .notification-indicator {
    position: absolute;
    top: -5px;
    right: -5px;
    width: 8px;
    height: 8px;
    background: var(--danger);
    border-radius: 50%;
  }

  .user-profile {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--accent-primary);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    color: white;
    flex-shrink: 0;
  }

  .user-info {
    display: none;
  }

  .user-name {
    font-weight: 500;
    font-size: 0.875rem;
  }

  .header-logout-btn {
    background: var(--danger);
    color: white;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    font-weight: 500;
    cursor: pointer;
    transition: var(--transition);
    font-size: 0.875rem;
  }

  .header-logout-btn:hover {
    background: #dc2626;
    transform: translateY(-1px);
  }

  /* Content Area */
  .content {
    padding: 2rem;
  }

  .welcome-header {
    margin-bottom: 2rem;
  }

  .welcome-title {
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
    background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
  }

  .welcome-subtitle {
    color: var(--text-secondary);
    font-size: 1.1rem;
  }

  .grid-container {
    display: grid;
    grid-template-columns: repeat(12, 1fr);
    gap: 1.5rem;
  }

  /* Admin Notices */
  .admin-notices {
    grid-column: span 12;
    margin-bottom: 1.5rem;
  }

  .notice {
    background: var(--bg-secondary);
    border-radius: 12px;
    border-left: 4px solid var(--warning);
    padding: 1.5rem;
    margin-bottom: 1rem;
    box-shadow: var(--shadow-md);
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    transition: var(--transition);
  }

  .notice:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
  }

  .notice-icon {
    font-size: 1.5rem;
    color: var(--warning);
    flex-shrink: 0;
  }

  .notice-content {
    flex: 1;
  }

  .notice-title {
    font-weight: 600;
    margin-bottom: 0.5rem;
    font-size: 1.1rem;
  }

  .notice-message {
    color: var(--text-secondary);
    font-size: 0.9rem;
    line-height: 1.5;
  }

  .notice-actions {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-top: 1rem;
    flex-wrap: wrap;
  }

  .notice-btn {
    font-size: 0.875rem;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    background: transparent;
    color: var(--text-secondary);
    border: 1px solid var(--border-color);
    transition: var(--transition);
    cursor: pointer;
    font-weight: 500;
  }

  .notice-btn:hover {
    background: var(--bg-tertiary);
    color: var(--text-primary);
  }

  .notice-btn.primary {
    background: var(--accent-primary);
    color: white;
    border-color: var(--accent-primary);
  }

  .notice-btn.primary:hover {
    background: #7c3aed;
  }

  .notice-close {
    color: var(--text-muted);
    font-size: 1.25rem;
    flex-shrink: 0;
    background: none;
    border: none;
    cursor: pointer;
    transition: var(--transition);
  }

  .notice-close:hover {
    color: var(--text-primary);
  }

  /* Dashboard Cards */
  .card {
    background: var(--bg-secondary);
    border-radius: 16px;
    border: 1px solid var(--border-color);
    padding: 1.5rem;
    box-shadow: var(--shadow-md);
    height: 100%;
    transition: var(--transition);
    display: flex;
    flex-direction: column;
  }

  .card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
  }

  .card-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1rem;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .card-title {
    font-weight: 600;
    font-size: 1.25rem;
  }

  .card-icon {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    background: rgba(139, 92, 246, 0.1);
    color: var(--accent-primary);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    flex-shrink: 0;
  }

  .card-content {
    margin-bottom: 1.5rem;
    flex: 1;
    color: var(--text-secondary);
    line-height: 1.6;
  }

  .card-footer {
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 1rem;
  }

  .card-stats {
    display: flex;
    flex-direction: column;
  }

  .stat-value {
    font-weight: 700;
    font-size: 1.75rem;
    color: var(--text-primary);
    font-family: 'SF Mono', SFMono-Regular, ui-monospace, Menlo, Monaco, Consolas, monospace;
  }

  .stat-label {
    font-size: 0.875rem;
    color: var(--text-muted);
    margin-top: 0.25rem;
  }

  .card-action {
    padding: 0.75rem 1.5rem;
    background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
    color: white;
    border-radius: 8px;
    font-weight: 600;
    font-size: 0.875rem;
    transition: var(--transition);
    text-align: center;
    border: none;
    cursor: pointer;
  }

  .card-action:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(139, 92, 246, 0.3);
  }

  /* Balance Refresh Button */
  .balance-refresh-btn {
    background: var(--bg-tertiary);
    color: var(--text-secondary);
    border: 1px solid var(--border-color);
    padding: 0.5rem;
    border-radius: 6px;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    font-size: 1rem;
  }

  .balance-refresh-btn:hover {
    background: var(--accent-primary);
    color: white;
    transform: translateY(-1px);
  }

  .balance-refresh-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
  }

  .balance-refresh-btn.loading {
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  .balance-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
  }

  .balance-info {
    display: flex;
    flex-direction: column;
    flex: 1;
  }

  .balance-meta {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: 0.25rem;
  }

  .balance-updated {
    font-size: 0.75rem;
    color: var(--text-muted);
  }

  .balance-status {
    font-size: 0.75rem;
    padding: 0.125rem 0.5rem;
    border-radius: 12px;
    font-weight: 500;
  }

  .balance-status.cached {
    background: rgba(245, 158, 11, 0.1);
    color: var(--warning);
  }

  .balance-status.fresh {
    background: rgba(34, 197, 94, 0.1);
    color: var(--success);
  }

  /* Balance Breakdown Section */
  .balance-breakdown {
    grid-column: span 12;
    margin-bottom: 2rem;
  }

  .balance-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
  }

  .balance-card {
    background: var(--bg-secondary);
    border-radius: 12px;
    border: 1px solid var(--border-color);
    padding: 1.5rem;
    transition: var(--transition);
    position: relative;
    overflow: hidden;
  }

  .balance-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
  }

  .balance-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
  }

  .balance-card-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1rem;
  }

  .balance-card-title {
    font-weight: 600;
    font-size: 1rem;
    color: var(--text-primary);
  }

  .balance-card-icon {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    background: rgba(139, 92, 246, 0.1);
    color: var(--accent-primary);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.25rem;
  }

  .balance-card-amount {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-primary);
    font-family: 'SF Mono', SFMono-Regular, ui-monospace, Menlo, Monaco, Consolas, monospace;
    margin-bottom: 0.5rem;
  }

  .balance-card-description {
    font-size: 0.875rem;
    color: var(--text-secondary);
    line-height: 1.4;
  }

  /* Quick Actions */
  .quick-actions {
    grid-column: span 12;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
  }

  /* Market Overview */
  .market-overview {
    grid-column: span 8;
  }

  .table-container {
    width: 100%;
    overflow-x: auto;
    border-radius: 12px;
    background: var(--bg-secondary);
  }

  .coin-list {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    min-width: 700px;
  }

  .coin-list th {
    text-align: left;
    padding: 1rem 1.5rem;
    font-weight: 600;
    color: var(--text-muted);
    font-size: 0.875rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    border-bottom: 1px solid var(--border-color);
    background: rgba(42, 52, 65, 0.5);
  }

  .coin-list th:first-child {
    border-top-left-radius: 12px;
  }

  .coin-list th:last-child {
    border-top-right-radius: 12px;
  }

  .coin-list td {
    padding: 1rem 1.5rem;
    border-bottom: 1px solid var(--border-color);
    font-size: 0.875rem;
  }

  .coin-list tbody tr {
    cursor: pointer;
    transition: var(--transition);
  }

  .coin-list tbody tr:hover {
    background: rgba(139, 92, 246, 0.05);
  }

  .coin-list tr:last-child td:first-child {
    border-bottom-left-radius: 12px;
  }

  .coin-list tr:last-child td:last-child {
    border-bottom-right-radius: 12px;
  }

  .coin-name {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .coin-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--bg-tertiary);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 0.875rem;
    flex-shrink: 0;
    overflow: hidden;
  }

  .coin-icon img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .coin-info {
    display: flex;
    flex-direction: column;
  }

  .coin-symbol {
    font-size: 0.75rem;
    color: var(--text-muted);
    font-weight: 500;
  }

  .coin-price {
    font-weight: 600;
    font-family: 'SF Mono', SFMono-Regular, ui-monospace, Menlo, Monaco, Consolas, monospace;
  }

  .coin-change {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    font-weight: 600;
    font-family: 'SF Mono', SFMono-Regular, ui-monospace, Menlo, Monaco, Consolas, monospace;
    padding: 0.25rem 0.5rem;
    border-radius: 6px;
    font-size: 0.875rem;
  }

  .change-positive {
    color: var(--success);
    background: rgba(34, 197, 94, 0.1);
  }

  .change-negative {
    color: var(--danger);
    background: rgba(239, 68, 68, 0.1);
  }

  .coin-actions {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .coin-btn {
    width: 36px;
    height: 36px;
    border-radius: 8px;
    background: var(--bg-tertiary);
    color: var(--text-muted);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.875rem;
    transition: var(--transition);
    border: none;
    cursor: pointer;
  }

  .coin-btn:hover {
    background: var(--accent-primary);
    color: white;
    transform: translateY(-2px);
  }

  .market-filters {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
  }

  .market-filter {
    padding: 0.75rem 1rem;
    border-radius: 8px;
    background: var(--bg-tertiary);
    color: var(--text-secondary);
    font-size: 0.875rem;
    font-weight: 500;
    transition: var(--transition);
    display: flex;
    align-items: center;
    gap: 0.5rem;
    border: none;
    cursor: pointer;
  }

  .market-filter:hover {
    background: rgba(139, 92, 246, 0.2);
  }

  .market-filter.active {
    background: var(--accent-primary);
    color: white;
  }

  .market-summary {
    display: flex;
    align-items: center;
    gap: 2rem;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
  }

  .market-stat {
    display: flex;
    flex-direction: column;
  }

  .market-stat-value {
    font-weight: 700;
    font-size: 1.25rem;
    font-family: 'SF Mono', SFMono-Regular, ui-monospace, Menlo, Monaco, Consolas, monospace;
  }

  .market-stat-label {
    font-size: 0.875rem;
    color: var(--text-muted);
    margin-bottom: 0.25rem;
  }

  .market-stat-change {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    font-size: 0.75rem;
    margin-top: 0.25rem;
  }

  /* Loading States */
  .loading-container {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 3rem;
  }

  .loading-spinner {
    width: 40px;
    height: 40px;
    border: 3px solid var(--bg-tertiary);
    border-top: 3px solid var(--accent-primary);
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  .error-container {
    padding: 2rem;
    text-align: center;
    color: var(--danger);
  }

  /* Academy Section */
  .academy-section {
    grid-column: span 4;
  }

  .course-grid {
    display: grid;
    gap: 1rem;
  }

  .course-card {
    background: var(--bg-tertiary);
    border-radius: 12px;
    padding: 1rem;
    transition: var(--transition);
    cursor: pointer;
  }

  .course-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
  }

  .course-image {
    width: 100%;
    height: 120px;
    background: var(--bg-primary);
    border-radius: 8px;
    margin-bottom: 1rem;
    overflow: hidden;
    position: relative;
  }

  .course-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .course-level {
    position: absolute;
    top: 0.5rem;
    left: 0.5rem;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    font-size: 0.75rem;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
  }

  .course-title {
    font-weight: 600;
    margin-bottom: 0.5rem;
    font-size: 1rem;
  }

  .course-description {
    color: var(--text-secondary);
    font-size: 0.875rem;
    margin-bottom: 1rem;
    line-height: 1.4;
  }

  .course-meta {
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .course-author {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .author-avatar {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: var(--accent-primary);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.75rem;
    color: white;
    font-weight: 600;
  }

  .author-name {
    font-size: 0.75rem;
    color: var(--text-muted);
  }

  .course-price {
    font-weight: 600;
    color: var(--accent-primary);
    font-size: 0.875rem;
  }

  /* Sidebar Overlay */
  .sidebar-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 999;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
  }

  .sidebar-overlay.active {
    opacity: 1;
    visibility: visible;
  }

  /* Modal Styles */
  .admin-notice-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    justify-content: center;
    align-items: center;
    backdrop-filter: blur(10px);
    z-index: 1100;
  }

  .admin-notice-modal {
    background: var(--bg-secondary);
    padding: 2rem;
    max-width: 500px;
    width: 90%;
    border-radius: 16px;
    box-shadow: var(--shadow-lg);
    border: 1px solid var(--border-color);
    color: var(--text-primary);
  }

  .admin-notice-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 1rem;
    margin-bottom: 1rem;
  }

  .admin-notice-title {
    font-size: 1.5rem;
    font-weight: 600;
    margin: 0;
  }

  .admin-notice-close {
    background: none;
    border: none;
    color: var(--text-muted);
    font-size: 1.5rem;
    cursor: pointer;
    transition: var(--transition);
  }

  .admin-notice-close:hover {
    color: var(--text-primary);
  }

  .admin-notice-content {
    font-size: 1rem;
    line-height: 1.6;
    margin-bottom: 1rem;
  }

  .admin-notice-meta {
    font-size: 0.875rem;
    color: var(--text-muted);
    margin-bottom: 1rem;
  }

  .admin-notice-expandable {
    display: none;
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-top: 1rem;
    line-height: 1.6;
  }

  .admin-notice-read-more {
    background: none;
    border: none;
    color: var(--accent-primary);
    font-size: 1rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    margin-top: 1rem;
    transition: var(--transition);
  }

  .admin-notice-read-more:hover {
    color: var(--accent-secondary);
  }

  .admin-notice-read-more-icon {
    margin-left: 0.5rem;
    font-size: 1.2rem;
    transition: transform 0.2s ease;
  }

  .admin-notice-footer {
    display: flex;
    justify-content: flex-end;
    margin-top: 1.5rem;
  }

  .admin-notice-button {
    background: var(--accent-primary);
    color: white;
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    font-size: 1rem;
    font-weight: 500;
    transition: var(--transition);
  }

  .admin-notice-button:hover {
    background: #7c3aed;
    transform: translateY(-2px);
  }

  /* Toast Notifications */
  .toast-container {
    position: fixed;
    top: 1rem;
    right: 1rem;
    z-index: 1200;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .toast {
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 1rem;
    box-shadow: var(--shadow-lg);
    color: var(--text-primary);
    font-weight: 500;
    transform: translateX(100%);
    opacity: 0;
    transition: all 0.3s ease;
  }

  .toast.show {
    transform: translateX(0);
    opacity: 1;
  }

  .toast-success {
    border-left: 4px solid var(--success);
  }

  .toast-error {
    border-left: 4px solid var(--danger);
  }

  .toast-warning {
    border-left: 4px solid var(--warning);
  }

  .toast-info {
    border-left: 4px solid var(--info);
  }

  /* Responsive Design */
  @media (max-width: 1200px) {
    .market-overview {
      grid-column: span 12;
    }

    .academy-section {
      grid-column: span 12;
    }

    .course-grid {
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    }
  }

  @media (max-width: 992px) {
    .sidebar {
      transform: translateX(-100%);
    }

    .sidebar.active {
      transform: translateX(0);
    }

    .main-content {
      margin-left: 0;
    }

    .mobile-toggle {
      display: block;
    }

    .user-info {
      display: block;
    }

    .quick-actions {
      grid-template-columns: 1fr;
    }

    .balance-cards {
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    }
  }

  @media (max-width: 768px) {
    .header {
      padding: 0 1rem;
    }

    .content {
      padding: 1rem;
    }

    .welcome-title {
      font-size: 1.5rem;
    }

    .card {
      padding: 1rem;
    }

    .card-header {
      flex-direction: column;
      align-items: flex-start;
    }

    .card-footer {
      flex-direction: column;
      align-items: flex-start;
    }

    .market-summary {
      gap: 1rem;
    }

    .market-stat {
      min-width: 120px;
    }

    .admin-notice-modal {
      padding: 1.5rem;
    }

    .balance-header {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.5rem;
    }

    .balance-cards {
      grid-template-columns: 1fr;
    }
  }

  @media (max-width: 576px) {
    .grid-container {
      gap: 1rem;
    }

    .notice {
      flex-direction: column;
      text-align: center;
    }

    .notice-actions {
      justify-content: center;
    }

    .market-summary {
      flex-direction: column;
      align-items: flex-start;
    }

    .course-grid {
      grid-template-columns: 1fr;
    }
  }

  /* Utility Classes */
  .text-center { text-align: center; }
  .text-success { color: var(--success); }
  .text-warning { color: var(--warning); }
  .text-danger { color: var(--danger); }
  .text-info { color: var(--info); }
  .text-muted { color: var(--text-muted); }
  .mb-1 { margin-bottom: 0.25rem; }
  .mb-2 { margin-bottom: 0.5rem; }
  .mb-3 { margin-bottom: 1rem; }
  .mt-3 { margin-top: 1rem; }
  .d-flex { display: flex; }
  .align-center { align-items: center; }
  .justify-between { justify-content: space-between; }
  .gap-1 { gap: 0.25rem; }
  .gap-2 { gap: 0.5rem; }
  .w-100 { width: 100%; }
  .h-100 { height: 100%; }
</style>
</head>
<body>
<div class="dashboard">
  <!-- Sidebar Overlay -->
  <div class="sidebar-overlay" id="sidebar-overlay"></div>
  
  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="logo">
        <div class="logo-icon">‚ö°</div>
        <span>Dashboard - fpx-markets</span>
      </div>
    </div>
    <div class="sidebar-content">
      <div class="sidebar-section">
        <h3 class="sidebar-section-title">Main</h3>
        <ul class="nav-list">
          <li class="nav-item">
            <a href="dashboard.html" class="nav-link active">
              <div class="nav-icon">üè†</div>
              <span class="nav-text">Dashboard</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="profile.html" class="nav-link">
              <div class="nav-icon">üë§</div>
              <span class="nav-text">Profile</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="notices-page.html" class="nav-link">
              <div class="nav-icon">üîî</div>
              <span class="nav-text">Notice Board</span>
              <span class="nav-badge">0</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="portfolio.html" class="nav-link">
              <div class="nav-icon">üìä</div>
              <span class="nav-text">Portfolio</span>
            </a>
          </li>
        </ul>
      </div>
      <div class="sidebar-section">
        <h3 class="sidebar-section-title">Transactions</h3>
        <ul class="nav-list">
          <li class="nav-item">
            <a href="transfer.html" class="nav-link">
              <div class="nav-icon">üí∏</div>
              <span class="nav-text">Transfer</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="convert.html" class="nav-link">
              <div class="nav-icon">üîÑ</div>
              <span class="nav-text">Convert</span>
            </a>
          </li>
        </ul>
      </div>
      <div class="sidebar-section">
        <h3 class="sidebar-section-title">Earn</h3>
        <ul class="nav-list">
          <li class="nav-item">
            <a href="academy.html" class="nav-link">
              <div class="nav-icon">üéì</div>
              <span class="nav-text">Academy</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="trade.html" class="nav-link">
              <div class="nav-icon">üìà</div>
              <span class="nav-text">Trade</span>
            </a>
          </li>
           <li class="nav-item">
            <a href="signals.html" class="nav-link active">
              <div class="nav-icon">üì°</div>
              <span class="nav-text">Trade Signals</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="community.html" class="nav-link">
              <div class="nav-icon">üë•</div>
              <span class="nav-text">Community</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="mining.html" class="nav-link">
              <div class="nav-icon">‚õèÔ∏è</div>
              <span class="nav-text">Mining</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="investment.html" class="nav-link">
              <div class="nav-icon">üí∞</div>
              <span class="nav-text">Investment</span>
            </a>
          </li>
        </ul>
      </div>
      <div class="sidebar-section">
        <h3 class="sidebar-section-title">Management</h3>
        <ul class="nav-list">
          <li class="nav-item">
            <a href="withdraw.html" class="nav-link">
              <div class="nav-icon">üì§</div>
              <span class="nav-text">Withdraw</span>
            </a>
            <li class="nav-item">
            <a href="withdraw-history.html" class="nav-link">
              <div class="nav-icon">üìú</div>
              <span class="nav-text">Withdrawal History</span>
            </a>
          </li>
          </li>
          <li class="nav-item">
            <a href="deposit.html" class="nav-link">
              <div class="nav-icon">üì•</div>
              <span class="nav-text">Deposit</span>
            </a>
          </li>
           <li class="nav-item">
            <a href="deposit-history.html" class="nav-link">
              <div class="nav-icon">üìú</div>
              <span class="nav-text">Deposit History</span>
            </a>
          </li>
        </ul>
      </div>
      <div class="sidebar-section">
        <h3 class="sidebar-section-title">Settings</h3>
        <ul class="nav-list">
          <li class="nav-item">
            <a href="Terms-and-Conditions.html" class="nav-link">
              <div class="nav-icon">üìã</div>
              <span class="nav-text">Terms & Conditions</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="privacy-policy.html" class="nav-link">
              <div class="nav-icon">üîí</div>
              <span class="nav-text">Privacy Policy</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="contact-us.html" class="nav-link active">
              <div class="nav-icon">üìû</div>
              <span class="nav-text">Help & Support</span>
            </a>
          </li>
        </ul>
      </div>
      
      <!-- Logout Button in Sidebar -->
      <button class="logout-btn" onclick="logout()">
        <span>üö™</span>
        <span>Logout</span>
      </button>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <header class="header">
      <div class="header-left">
        <button class="mobile-toggle" id="mobile-toggle">‚ò∞</button>
      </div>
      <div class="header-right">
        <button class="header-icon" onclick="window.location.href='notifications.html';">
          üîî
          <span class="notification-indicator"></span>
        </button>
        <div class="user-profile">
          <div class="avatar">JD</div>
          <div class="user-info">
            <div class="user-name">Light Potato</div>
          </div>
        </div>
        <!-- Logout Button in Header -->
        <button class="header-logout-btn" onclick="logout()">
          Logout
        </button>
      </div>
    </header>

    <div class="content">
      <div class="welcome-header">
        <h1 class="welcome-title">Welcome back, Light</h1>
        <p class="welcome-subtitle">Here's what's happening with your crypto assets today.</p>
      </div>

      <div class="grid-container">
        <!-- Notices -->
        <div class="admin-notices" id="notifications-container">
          <!-- Notifications will be loaded here -->
        </div>

        <!-- Admin Modal for Showing Notification Details -->
        <div id="admin-notice-overlay" class="admin-notice-overlay">
          <div class="admin-notice-modal">
            <div class="admin-notice-header">
              <h3 id="admin-notice-title" class="admin-notice-title">Notification Title</h3>
              <button class="admin-notice-close" onclick="closeModal()">‚úï</button>
            </div>
            <div class="admin-notice-body">
              <p id="admin-notice-message" class="admin-notice-content">Notification Message</p>
              <p id="admin-notice-date" class="admin-notice-meta">Date</p>
              <div id="admin-notice-expandable" class="admin-notice-expandable">
                Additional details...
              </div>
              <button id="admin-notice-read-more" class="admin-notice-read-more" onclick="toggleExpandable()">
                Read More
                <span id="admin-notice-read-more-icon" class="admin-notice-read-more-icon">‚Üì</span>
              </button>
            </div>
            <div class="admin-notice-footer">
              <button class="admin-notice-button" onclick="window.location.href='notices-page.html';">
                Go to Notices Page
              </button>
            </div>
          </div>
        </div>

        <!-- Balance Breakdown Section -->
        <div class="balance-breakdown">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Account Balances</h3>
              <button class="balance-refresh-btn" id="balance-refresh-btn" onclick="refreshBalances()" title="Refresh Balances">
                üîÑ
              </button>
            </div>
            <div class="balance-cards">
              <div class="balance-card">
                <div class="balance-card-header">
                  <h4 class="balance-card-title">Currency Balance</h4>
                  <div class="balance-card-icon">üí∞</div>
                </div>
                <div class="balance-card-amount" id="currency-balance">$0.00</div>
                <p class="balance-card-description">Available for trading and transfers</p>
              </div>

              <div class="balance-card">
                <div class="balance-card-header">
                  <h4 class="balance-card-title">Trade Balance</h4>
                  <div class="balance-card-icon">üìà</div>
                </div>
                <div class="balance-card-amount" id="trade-balance">$0.00</div>
                <p class="balance-card-description">Funds allocated for trading activities</p>
              </div>

              <div class="balance-card">
                <div class="balance-card-header">
                  <h4 class="balance-card-title">Profits</h4>
                  <div class="balance-card-icon">üéØ</div>
                </div>
                <div class="balance-card-amount" id="profits-balance">$0.00</div>
                <p class="balance-card-description">Earnings from investments and trading</p>
              </div>

              <div class="balance-card">
                <div class="balance-card-header">
                  <h4 class="balance-card-title">USD Wallet</h4>
                  <div class="balance-card-icon">üíµ</div>
                </div>
                <div class="balance-card-amount" id="usd-wallet-balance">$0.00</div>
                <p class="balance-card-description">USD wallet balance</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Total Assets</h3>
              <div class="card-icon">üìä</div>
            </div>
            <div class="card-content">
              <p>View and manage your complete portfolio including crypto assets, fiat balances, and total holdings.</p>
            </div>
            <div class="card-footer">
              <div class="balance-header">
                <div class="balance-info">
                  <div class="stat-value" id="grand-total-value">$0.00</div>
                  <div class="balance-meta">
                    <div class="stat-label">Total Portfolio Value</div>
                    <div class="balance-status" id="balance-status">cached</div>
                  </div>
                  <div class="balance-updated" id="balance-updated">Last updated: --</div>
                </div>
                <button class="balance-refresh-btn" id="portfolio-refresh-btn" onclick="refreshPortfolioTotal()" title="Refresh Portfolio">
                  üîÑ
                </button>
              </div>
              <button class="card-action" onclick="window.location.href='portfolio.html'">View Portfolio</button>
            </div>
          </div>
          
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Convert Crypto</h3>
              <div class="card-icon">üîÑ</div>
            </div>
            <div class="card-content">
              <p>Convert between different cryptocurrencies at competitive rates with real-time market pricing.</p>
            </div>
            <div class="card-footer">
              <div class="card-stats">
                <div class="stat-value">30+</div>
                <div class="stat-label">Available Pairs</div>
              </div>
              <button class="card-action" onclick="window.location.href='convert.html'">Convert Now</button>
            </div>
          </div>
          
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Earn Rewards</h3>
              <div class="card-icon">‚õèÔ∏è</div>
            </div>
            <div class="card-content">
              <p>Stake your crypto assets and earn passive income with competitive APY rates and flexible terms.</p>
            </div>
            <div class="card-footer">
              <div class="card-stats">
                <div class="stat-value">12.5%</div>
                <div class="stat-label">Avg. APY</div>
              </div>
              <button class="card-action" onclick="window.location.href='mining.html'">Start Earning</button>
            </div>
          </div>
        </div>

        <!-- Market Overview -->
        <div class="market-overview">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Market Overview</h3>
              <div class="market-filters">
                <button class="market-filter active" id="all-btn">
                  üìä All Assets
                </button>
                <button class="market-filter" id="favorites-btn">
                  ‚≠ê Favorites
                </button>
                <button class="market-filter" id="trending-btn">
                  üî• Trending
                </button>
              </div>
            </div>
            <div class="card-content">
              <div class="market-summary">
                <div class="market-stat">
                  <div class="market-stat-label">Global Market Cap</div>
                  <div class="market-stat-value" id="global-market-cap">$2.45T</div>
                  <div class="market-stat-change change-positive">
                    ‚ÜóÔ∏è <span>2.4%</span>
                  </div>
                </div>
                <div class="market-stat">
                  <div class="market-stat-label">24h Volume</div>
                  <div class="market-stat-value" id="global-volume">$98.7B</div>
                </div>
                <div class="market-stat">
                  <div class="market-stat-label">BTC Dominance</div>
                  <div class="market-stat-value" id="btc-dominance">48.2%</div>
                </div>
              </div>
              <div class="table-container">
                <table class="coin-list">
                  <thead>
                    <tr>
                      <th>Asset</th>
                      <th>Price</th>
                      <th>24h Change</th>
                      <th>Market Cap</th>
                      <th>Volume (24h)</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="crypto-table-body">
                    <tr>
                      <td colspan="6">
                        <div class="loading-container">
                          <div class="loading-spinner"></div>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Academy Section -->
        <div class="academy-section">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Academy Updates</h3>
              <button class="notice-btn primary" onclick="window.location.href='academy.html';">
                üìö View All
              </button>
            </div>
            <div class="course-grid" id="course-grid">
              <!-- Courses will be loaded here -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- Toast container -->
<div class="toast-container" id="toast-container"></div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
  // API Configuration
  const api = axios.create({
    baseURL: "https://api.fpx-markets.cmctradevault.com/api",
    headers: {
      "Content-Type": "application/json",
      "Authorization": `Bearer ${localStorage.getItem("token")}`
    }
  });

  // Global variables for balance data
  let balanceData = {
    grand_total: 0,
    crypto_total_usd: 0,
    currency_balance: 0,
    trade_balance: 0,
    earn_balance: 0,
    usd_wallet: 0,
    updated_at: null,
    is_cached: false
  };

  let accountBalances = {
    currency_balance: 0,
    trade_balance: 0,
    earn_balance: 0,
    usd_wallet: 0
  };

  // Initialize Dashboard
  document.addEventListener("DOMContentLoaded", async () => {
    try {
      // Fetch user profile
      const response = await api.get("/users/profile/username");
      const username = response.data.username;

      // Update UI with user info
      document.querySelector(".user-name").textContent = username;
      document.querySelector(".welcome-title").textContent = `Welcome back, ${username.split(" ")[0]}`;
      const initials = username.split(' ').map(word => word[0]).join('').toUpperCase();
      document.querySelector(".avatar").textContent = initials;

    } catch (error) {
      console.error("Failed to fetch username:", error);
    }

    // Initialize all dashboard components
    await Promise.all([
      fetchUnreadNotifications(),
      fetchAccountBalances(),
      fetchGrandTotal(),
      loadCourses(),
      loadUnreadNotificationCount(),
      fetchCryptoData('all'),
      fetchGlobalData()
    ]);
  });

  // Logout Function
  function logout() {
    if (confirm('Are you sure you want to logout?')) {
      // Clear authentication data
      localStorage.removeItem('token');
      localStorage.removeItem('user');
      
      // Show logout message
      showToast('Logged out successfully', 'success');
      
      // Redirect to login page after a short delay
      setTimeout(() => {
        window.location.href = 'login.html';
      }, 1000);
    }
  }

  // Account Balances Functions - Using the new /balances endpoint
  async function fetchAccountBalances() {
    try {
      const response = await api.get("/users/balances");
      const data = response.data;

      if (data.balances) {
        accountBalances = {
          currency_balance: parseFloat(data.balances.currency_balance || 0),
          trade_balance: parseFloat(data.balances.trade_balance || 0),
          earn_balance: parseFloat(data.balances.earn_balance || 0),
          usd_wallet: parseFloat(data.balances.usd_wallet || 0)
        };

        updateAccountBalancesDisplay();
      }
      
    } catch (error) {
      console.error("Failed to fetch account balances:", error);
      showToast('Failed to load account balances', 'error');
    }
  }

  async function refreshBalances() {
    const refreshBtn = document.getElementById('balance-refresh-btn');
    
    try {
      // Show loading state
      refreshBtn.disabled = true;
      refreshBtn.classList.add('loading');
      showToast('Refreshing account balances...', 'info');

      // Fetch fresh balance data
      await fetchAccountBalances();
      
      showToast('Account balances refreshed', 'success');
      
    } catch (error) {
      console.error("Failed to refresh balances:", error);
      showToast('Failed to refresh balances', 'error');
    } finally {
      // Reset button state
      refreshBtn.disabled = false;
      refreshBtn.classList.remove('loading');
    }
  }

  function updateAccountBalancesDisplay() {
    // Format and display balance values
    const formatCurrency = (value) => {
      return value.toLocaleString('en-US', {
        style: 'currency',
        currency: 'USD'
      });
    };

    document.getElementById('currency-balance').textContent = formatCurrency(accountBalances.currency_balance);
    document.getElementById('trade-balance').textContent = formatCurrency(accountBalances.trade_balance);
    document.getElementById('profits-balance').textContent = formatCurrency(accountBalances.earn_balance);
    document.getElementById('usd-wallet-balance').textContent = formatCurrency(accountBalances.usd_wallet);
  }

  // Portfolio Total Functions - Updated to use the new endpoint with refresh capability
  async function fetchGrandTotal() {
    try {
      const response = await api.get("/users/wallet/crypto-usd/price-sum");
      const data = response.data;

      // Store balance data
      balanceData = {
        grand_total: parseFloat(data.grand_total || 0),
        crypto_total_usd: parseFloat(data.crypto_total_usd || 0),
        currency_balance: parseFloat(data.currency_balance || 0),
        trade_balance: parseFloat(data.trade_balance || 0),
        earn_balance: parseFloat(data.earn_balance || 0),
        updated_at: data.updated_at || new Date().toISOString(),
        is_cached: data.message && data.message.includes('Cached')
      };

      updatePortfolioDisplay();
      
    } catch (error) {
      console.error("Failed to fetch grand total:", error);
      document.getElementById("grand-total-value").textContent = "$0.00";
      showToast('Failed to load portfolio data', 'error');
    }
  }

  async function refreshPortfolioTotal() {
    const refreshBtn = document.getElementById('portfolio-refresh-btn');
    
    try {
      // Show loading state
      refreshBtn.disabled = true;
      refreshBtn.classList.add('loading');
      showToast('Refreshing portfolio total...', 'info');

      // Force refresh by calling the endpoint (it will recalculate if needed)
      const response = await api.get("/users/wallet/crypto-usd/price-sum");
      const data = response.data;

      // Update balance data
      balanceData = {
        grand_total: parseFloat(data.grand_total || 0),
        crypto_total_usd: parseFloat(data.crypto_total_usd || 0),
        currency_balance: parseFloat(data.currency_balance || 0),
        trade_balance: parseFloat(data.trade_balance || 0),
        earn_balance: parseFloat(data.earn_balance || 0),
        updated_at: data.updated_at || new Date().toISOString(),
        is_cached: data.message && data.message.includes('Cached')
      };

      updatePortfolioDisplay();
      
      const message = data.message.includes('Recalculated') 
        ? 'Portfolio refreshed with latest data' 
        : 'Portfolio is up to date';
      
      showToast(message, 'success');
      
    } catch (error) {
      console.error("Failed to refresh portfolio:", error);
      showToast('Failed to refresh portfolio', 'error');
    } finally {
      // Reset button state
      refreshBtn.disabled = false;
      refreshBtn.classList.remove('loading');
    }
  }

  function updatePortfolioDisplay() {
    // Format and display the grand total
    const formatted = balanceData.grand_total.toLocaleString('en-US', {
      style: 'currency',
      currency: 'USD'
    });

    document.getElementById("grand-total-value").textContent = formatted;

    // Update status indicator
    const statusElement = document.getElementById('balance-status');
    const updatedElement = document.getElementById('balance-updated');
    
    if (balanceData.is_cached) {
      statusElement.textContent = 'cached';
      statusElement.className = 'balance-status cached';
    } else {
      statusElement.textContent = 'fresh';
      statusElement.className = 'balance-status fresh';
    }

    // Format the updated time
    if (balanceData.updated_at) {
      const updatedDate = new Date(balanceData.updated_at);
      const now = new Date();
      const diffMinutes = Math.floor((now - updatedDate) / (1000 * 60));
      
      let timeText;
      if (diffMinutes < 1) {
        timeText = 'Just now';
      } else if (diffMinutes < 60) {
        timeText = `${diffMinutes}m ago`;
      } else if (diffMinutes < 1440) {
        timeText = `${Math.floor(diffMinutes / 60)}h ago`;
      } else {
        timeText = updatedDate.toLocaleDateString();
      }
      
      updatedElement.textContent = `Last updated: ${timeText}`;
    }
  }

  // Notification Functions
  async function fetchUnreadNotifications() {
    try {
      const response = await api.get("/users/notifications/unread");
      const data = response.data;

      if (data.data && data.data.length > 0) {
        renderNotifications(data.data);
      }
    } catch (error) {
      console.error("Error fetching notifications:", error);
    }
  }

  function renderNotifications(notifications) {
    const container = document.getElementById("notifications-container");
    container.innerHTML = "";

    notifications.forEach(notification => {
      const div = document.createElement("div");
      div.className = "notice";

      div.innerHTML = `
        <div class="notice-icon">‚ö†Ô∏è</div>
        <div class="notice-content">
          <h4 class="notice-title">${notification.title || 'No Title'}</h4>
          <p class="notice-message">${notification.details || 'No message available'}</p>
          <div class="notice-actions">
            <button class="notice-btn primary" onclick="event.stopPropagation(); learnMore(${notification.id})">Learn More</button>
            <button class="notice-btn" onclick="event.stopPropagation(); markAsRead(${notification.id}, this)">Mark Read</button>
          </div>
        </div>
        <button class="notice-close" onclick="event.stopPropagation(); this.parentElement.remove()">‚úï</button>
      `;
      container.appendChild(div);
    });
  }

  async function markAsRead(notificationId, button) {
    try {
      const response = await api.post(`/users/notifications/${notificationId}/read`);
      const result = response.data;

      if (response.status === 200) {
        showToast(result.message || "Marked as read", "success");
        button.closest(".notice").remove();
      } else {
        showToast(result.message || "Failed to mark as read", "error");
      }
    } catch (error) {
      console.error("Error marking as read:", error);
      showToast("An error occurred while marking as read", "error");
    }
  }

  function learnMore(notificationId) {
    api.get(`/users/notifications/${notificationId}`)
      .then(response => {
        const data = response.data;
        if (data.message === "Notification fetched successfully") {
          const notification = data.data;

          document.getElementById('admin-notice-title').innerText = notification.title;
          document.getElementById('admin-notice-message').innerText = notification.message;
          document.getElementById('admin-notice-date').innerText = notification.noticeDate;
          document.getElementById('admin-notice-expandable').innerHTML = notification.details;

          document.getElementById('admin-notice-overlay').style.display = 'flex';
        } else {
          showToast('Notification not found.', 'error');
        }
      })
      .catch(error => {
        console.error('Error fetching notification:', error);
        showToast('Something went wrong. Please try again.', 'error');
      });
  }

  function toggleExpandable() {
    const expandable = document.getElementById("admin-notice-expandable");
    const readMoreButton = document.getElementById("admin-notice-read-more");
    const icon = document.getElementById("admin-notice-read-more-icon");

    if (expandable.style.display === "none" || expandable.style.display === "") {
      expandable.style.display = "block";
      icon.textContent = "‚Üë";
      readMoreButton.innerHTML = 'Read Less <span class="admin-notice-read-more-icon">‚Üë</span>';
    } else {
      expandable.style.display = "none";
      icon.textContent = "‚Üì";
      readMoreButton.innerHTML = 'Read More <span class="admin-notice-read-more-icon">‚Üì</span>';
    }
  }

  function closeModal() {
    document.getElementById("admin-notice-overlay").style.display = "none";
  }

  // Course Functions
  async function loadCourses() {
    try {
      const response = await api.get("/users/courses");
      const courses = response.data.courses;

      const courseGrid = document.getElementById("course-grid");
      courseGrid.innerHTML = "";

      courses.slice(0, 3).forEach(course => {
        const authorInitial = course.author_name?.charAt(0).toUpperCase() || "U";

        const courseHTML = `
          <div class="course-card" onclick="window.location.href='academy.html'">
            <div class="course-image">
              <img src="https://api.fpx-markets.cmctradevault.com${course.bannerImg}" alt="${course.title}">
              <div class="course-level">Premium</div>
            </div>
            <div class="course-content">
              <h4 class="course-title">${course.title}</h4>
              <p class="course-description">Pay ‚Ç¶${course.price} to unlock full content and start learning.</p>
              <div class="course-meta">
                <div class="course-author">
                  <div class="author-avatar">${authorInitial}</div>
                  <div class="author-name">${course.author_name}</div>
                </div>
                <div class="course-price">‚Ç¶${course.price}</div>
              </div>
            </div>
          </div>
        `;
        courseGrid.insertAdjacentHTML("beforeend", courseHTML);
      });
    } catch (error) {
      console.error("Failed to load courses:", error);
      document.getElementById("course-grid").innerHTML = "<p>Error loading courses.</p>";
    }
  }

  async function loadUnreadNotificationCount() {
    try {
      const response = await api.get("/users/notifications/count/unread");
      const unreadCount = response.data.unreadCount;

      const badge = document.querySelector(".nav-badge");
      if (unreadCount > 0) {
        badge.textContent = unreadCount;
        badge.style.display = "inline-block";
      } else {
        badge.style.display = "none";
      }
    } catch (error) {
      console.error("Failed to load unread notification count:", error);
    }
  }

  // Market Data Functions
  async function fetchGlobalData() {
    try {
      const response = await fetch('https://api.coingecko.com/api/v3/global');
      const data = await response.json();
      
      const marketCap = data.data.total_market_cap.usd;
      const volume = data.data.total_volume.usd;
      const dominance = data.data.market_cap_percentage.btc;
      
      document.getElementById('global-market-cap').textContent = `$${(marketCap / 1e12).toFixed(2)}T`;
      document.getElementById('global-volume').textContent = `$${(volume / 1e9).toFixed(2)}B`;
      document.getElementById('btc-dominance').textContent = `${dominance.toFixed(1)}%`;
      
    } catch (error) {
      console.error('Error fetching global data:', error);
    }
  }

  async function fetchCryptoData(type = 'all') {
    try {
      document.getElementById('crypto-table-body').innerHTML = `
        <tr>
          <td colspan="6">
            <div class="loading-container">
              <div class="loading-spinner"></div>
            </div>
          </td>
        </tr>
      `;
      
      let url;
      if (type === 'trending') {
        url = 'https://api.coingecko.com/api/v3/search/trending';
      } else {
        url = 'https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=100&page=1&sparkline=false&price_change_percentage=24h';
      }
      
      const response = await fetch(url);
      let data;
      
      if (type === 'trending') {
        const result = await response.json();
        const coinIds = result.coins.map(coin => coin.item.id).join(',');
        const detailResponse = await fetch(`https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&ids=${coinIds}&order=market_cap_desc&sparkline=false&price_change_percentage=24h`);
        data = await detailResponse.json();
      } else {
        data = await response.json();
        
        if (type === 'favorites') {
          const favorites = JSON.parse(localStorage.getItem('favorites')) || [];
          data = data.filter(coin => favorites.includes(coin.id));
        }
      }
      
      document.getElementById('crypto-table-body').innerHTML = '';
      
      if (data.length === 0) {
        document.getElementById('crypto-table-body').innerHTML = `
          <tr>
            <td colspan="6" class="text-center">
              <p>No data available</p>
            </td>
          </tr>
        `;
        return;
      }
      
      const displayData = data.slice(0, 10);
      
      displayData.forEach(coin => {
        const favorites = JSON.parse(localStorage.getItem('favorites')) || [];
        const isFavorite = favorites.includes(coin.id);
        const priceChangeClass = coin.price_change_percentage_24h >= 0 ? 'change-positive' : 'change-negative';
        const priceChangeIcon = coin.price_change_percentage_24h >= 0 ? '‚ÜóÔ∏è' : '‚ÜòÔ∏è';
        
        const row = document.createElement('tr');
        row.setAttribute('data-coin-id', coin.id);
        row.innerHTML = `
          <td>
            <div class="coin-name">
              <div class="coin-icon">
                <img src="${coin.image}" alt="${coin.name}">
              </div>
              <div class="coin-info">
                <div>${coin.name}</div>
                <div class="coin-symbol">${coin.symbol.toUpperCase()}</div>
              </div>
            </div>
          </td>
          <td class="coin-price">$${coin.current_price.toFixed(2)}</td>
          <td>
            <div class="coin-change ${priceChangeClass}">
              ${priceChangeIcon}
              <span>${Math.abs(coin.price_change_percentage_24h).toFixed(2)}%</span>
            </div>
          </td>
          <td>$${(coin.market_cap / 1e9).toFixed(2)}B</td>
          <td>$${(coin.total_volume / 1e9).toFixed(2)}B</td>
          <td>
            <div class="coin-actions">
              <button class="coin-btn" onclick="window.location.href='transfer.html'" title="Transfer">üí∏</button>
              <button class="coin-btn" onclick="window.location.href='convert.html'" title="Convert">üîÑ</button>
              <button class="coin-btn favorite-btn" data-coin-id="${coin.id}" title="Add to Favorites">
                ${isFavorite ? '‚≠ê' : '‚òÜ'}
              </button>
            </div>
          </td>
        `;
        
        document.getElementById('crypto-table-body').appendChild(row);
      });
      
      // Add event listeners to favorite buttons
      document.querySelectorAll('.favorite-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const coinId = btn.getAttribute('data-coin-id');
          const favorites = JSON.parse(localStorage.getItem('favorites')) || [];
          
          if (favorites.includes(coinId)) {
            const newFavorites = favorites.filter(id => id !== coinId);
            localStorage.setItem('favorites', JSON.stringify(newFavorites));
            btn.textContent = '‚òÜ';
          } else {
            favorites.push(coinId);
            localStorage.setItem('favorites', JSON.stringify(favorites));
            btn.textContent = '‚≠ê';
          }
        });
      });
      
    } catch (error) {
      console.error('Error fetching crypto data:', error);
      document.getElementById('crypto-table-body').innerHTML = `
        <tr>
          <td colspan="6" class="error-container">
            <p>Failed to load cryptocurrency data. Please try again later.</p>
            <button class="notice-btn primary mt-3" onclick="fetchCryptoData('${type}')">Retry</button>
          </td>
        </tr>
      `;
    }
  }

  // Event Listeners
  document.getElementById('all-btn').addEventListener('click', () => {
    document.querySelectorAll('.market-filter').forEach(btn => btn.classList.remove('active'));
    document.getElementById('all-btn').classList.add('active');
    fetchCryptoData('all');
  });
  
  document.getElementById('favorites-btn').addEventListener('click', () => {
    document.querySelectorAll('.market-filter').forEach(btn => btn.classList.remove('active'));
    document.getElementById('favorites-btn').classList.add('active');
    fetchCryptoData('favorites');
  });
  
  document.getElementById('trending-btn').addEventListener('click', () => {
    document.querySelectorAll('.market-filter').forEach(btn => btn.classList.remove('active'));
    document.getElementById('trending-btn').classList.add('active');
    fetchCryptoData('trending');
  });

  // Utility Functions
  function showToast(message, type = 'info') {
    const container = document.getElementById('toast-container');
    const toast = document.createElement('div');
    toast.className = `toast toast-${type}`;
    toast.textContent = message;

    container.appendChild(toast);

    // Show toast
    setTimeout(() => {
      toast.classList.add('show');
    }, 100);

    // Remove toast after 4 seconds
    setTimeout(() => {
      toast.classList.remove('show');
      setTimeout(() => {
        if (toast.parentNode) {
          toast.remove();
        }
      }, 300);
    }, 4000);
  }

  // Sidebar Toggle Functions
  const sidebar = document.getElementById('sidebar');
  const mobileToggle = document.getElementById('mobile-toggle');
  const mainContent = document.querySelector('.main-content');
  const sidebarOverlay = document.getElementById('sidebar-overlay');

  function toggleSidebarVisibility() {
    sidebar.classList.toggle('active');
    sidebarOverlay.classList.toggle('active');
  }

  mobileToggle.addEventListener('click', toggleSidebarVisibility);
  sidebarOverlay.addEventListener('click', () => {
    sidebar.classList.remove('active');
    sidebarOverlay.classList.remove('active');
  });

  // Responsive handling
  function handleResize() {
    if (window.innerWidth < 992) {
      sidebar.classList.remove('active');
      sidebarOverlay.classList.remove('active');
    } else {
      sidebar.classList.add('active');
    }
  }

  window.addEventListener('DOMContentLoaded', handleResize);
  window.addEventListener('resize', handleResize);

  // Close modal when clicking outside
  document.getElementById('admin-notice-overlay').addEventListener('click', (e) => {
    if (e.target === document.getElementById('admin-notice-overlay')) {
      closeModal();
    }
  });

  // Add active class to current nav link
  const navLinks = document.querySelectorAll('.nav-link');
  const currentPage = window.location.pathname.split('/').pop() || 'dashboard.html';
  
  navLinks.forEach(link => {
    const href = link.getAttribute('href');
    if (href === currentPage) {
      link.classList.add('active');
    } else {
      link.classList.remove('active');
    }
  });

  // Auto-refresh balances every 5 minutes
  setInterval(() => {
    fetchAccountBalances();
    fetchGrandTotal();
  }, 5 * 60 * 1000);
</script>

<!-- Authentication Script -->
<script src="../js/withAuth.js"></script>
   <!-- Google Translate Widget -->
   <div id="google_translate_element"></div>

    <script>
      function googleTranslateElementInit() {
        new google.translate.TranslateElement({ pageLanguage: 'en' }, 'google_translate_element');
      }
    </script>

    <script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

    <script>
      // Preserve translation by checking the cookie on page load
      document.addEventListener("DOMContentLoaded", () => {
        const lang = getCookie("googtrans");
        if (lang && lang !== "/en/en") {
          document.cookie = `googtrans=${lang}; path=/`;
        }
      });

      function getCookie(name) {
        const match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
        return match ? match[2] : null;
      }
    </script>
</body>
</html>